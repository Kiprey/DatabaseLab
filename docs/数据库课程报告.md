# 一、概念结构设计

首先我们powerdesigner中设计数据库的概念模型，针对我们要设计的教务管理系统的具体需求，构建了八个数据表

- 院系
- 专业
- 班级
- 学生
- 教师
- 课程
- 学生选课
- 课程班级

对于这些数据表之间的关系

存在如下关系：

学生————n_1————班级

班级————n_1————专业

专业————n_1————院系

教师————n_1————院系

教师————1_n————课程班级

课程————1_n————课程班级

学生————1_n————学生选课

学生选课————1_n————课程班级

根据上面的这些关系，我们可以构建出如下的概念结构模型：

![image-20220602153138271](数据库课程报告/image-20220602153138271.png)

# 二、逻辑结构设计

之后通过powerdesigner将设计好的概念结构模型转换成逻辑结构模型

![image-20220602153318611](数据库课程报告/image-20220602153318611.png)

# 三、物理结构设计

最后通过powerdesigner将逻辑结构模型生成物理结构模型，并生成相应的sql代码。

## 1.物理结构模型图

![image-20220602153332585](数据库课程报告/image-20220602153332585.png)

## 2.数据库建立SQL语句

```sql
/*==============================================================*/
/* DBMS name:      MySQL 5.0                                    */
/* Created on:     2022-05-18 10:03:38                          */
/*==============================================================*/

drop table if exists StudentCourse;

drop table if exists CourseClass;

drop table if exists Student;

drop table if exists Teacher;

drop table if exists Class;

drop table if exists Course;

drop table if exists Major;

drop table if exists Faculty;


/*==============================================================*/
/* Table: Class                                                 */
/*==============================================================*/
create table Class
(
   className            varchar(20) not null,
   classCode            varchar(20) not null,
   majorCode            varchar(20) not null,
   primary key (classCode)
);

/*==============================================================*/
/* Table: Course                                                */
/*==============================================================*/
create table Course
(
   courseName           varchar(20) not null,
   courseNature         varchar(20) not null,
   courseCategory       varchar(20) not null,
   courseID             varchar(20) not null,
   facultyCode          varchar(20) not null,
   courseHours          int not null,
   credit               int not null,
   primary key (courseID)
);

/*==============================================================*/
/* Table: CourseClass                                           */
/*==============================================================*/
create table CourseClass
(
   courseClassID        varchar(20) not null,
   courseID             varchar(20) not null,
   teacherID            varchar(20) not null,
   courseClassTime      varchar(20),
   courseClassAddress   varchar(20),
   courseClassWeek      varchar(20),
   primary key (courseClassID)
);

/*==============================================================*/
/* Table: Faculty                                               */
/*==============================================================*/
create table Faculty
(
   facultyName          varchar(20) not null,
   facultyCode          varchar(20) not null,
   facultyAddress       varchar(20),
   facultyTeleno        varchar(20),
   primary key (facultyCode)
);

/*==============================================================*/
/* Table: Major                                                 */
/*==============================================================*/
create table Major
(
   majorName            varchar(20) not null,
   majorCode            varchar(20) not null,
   facultyCode          varchar(20) not null,
   degreeLevel          varchar(20) not null,
   graduationCredits    varchar(20) not null,
   primary key (majorCode)
);

/*==============================================================*/
/* Table: Student                                               */
/*==============================================================*/
create table Student
(
   studentName          varchar(20) not null,
   studentID            varchar(20) not null,
   classCode            varchar(20) not null,
   identifier           varchar(20),
   dormitory            varchar(20),
   address              varchar(100),
   teleno               varchar(20),
   birthday             date,
   sex                  varchar(20),
   grade                varchar(20),
   completedCredits     int,
   primary key (studentID)
);

/*==============================================================*/
/* Table: StudentCourse                                         */
/*==============================================================*/
create table StudentCourse
(
   courseClassID        varchar(20) not null,
   studentID            varchar(20) not null,
   score                int,
   primary key (courseClassID, studentID)
);

/*==============================================================*/
/* Table: Teacher                                               */
/*==============================================================*/
create table Teacher
(
   teacherName          varchar(20) not null,
   teacherID            varchar(20) not null,
   facultyCode          varchar(20) not null,
   primary key (teacherID)
);

alter table Class add constraint FK_Class_Major foreign key (majorCode)
      references Major (majorCode) on delete restrict on update cascade;

alter table Course add constraint FK_CourseFaculty foreign key (facultyCode)
      references Faculty (facultyCode) on delete restrict on update cascade;

alter table CourseClass add constraint FK_CourseOffer foreign key (courseID)
      references Course (courseID) on delete restrict on update cascade;

alter table CourseClass add constraint FK_TeacherTeaching foreign key (teacherID)
      references Teacher (teacherID) on delete restrict on update cascade;

alter table Major add constraint FK_Major_Faculty foreign key (facultyCode)
      references Faculty (facultyCode) on delete restrict on update cascade;

alter table Student add constraint FK_StudentClass foreign key (classCode)
      references Class (classCode) on delete restrict on update cascade;

alter table StudentCourse add constraint FK_StudentCourse foreign key (studentID)
      references Student (studentID) on delete restrict on update cascade;

alter table StudentCourse add constraint FK_StudentCourse2 foreign key (courseClassID)
      references CourseClass (courseClassID) on delete restrict on update cascade;

alter table Teacher add constraint FK_TeacherFaculty foreign key (facultyCode)
      references Faculty (facultyCode) on delete restrict on update cascade;




CREATE TRIGGER credit1
AFTER INSERT  ON studentcourse  -- 在插入后修改对应已修学分
FOR EACH ROW
BEGIN
	UPDATE student SET completedCredits=
	(SELECT sum(credit) as sum FROM course,courseclass,studentcourse WHERE
	studentcourse.studentID=new.studentID and 
	studentcourse.score>60 and 
	studentcourse.courseClassID=courseclass.courseClassID and 
	course.courseID=courseclass.courseID);
END;

CREATE TRIGGER credit2
AFTER UPDATE  ON studentcourse  -- 在更新后修改对应已修学分
FOR EACH ROW
BEGIN
	UPDATE student SET completedCredits=
	(SELECT sum(credit) as sum FROM course,courseclass,studentcourse WHERE
	studentcourse.studentID=new.studentID and 
	studentcourse.score>60 and 
	studentcourse.courseClassID=courseclass.courseClassID and 
	course.courseID=courseclass.courseID);
END;

CREATE TRIGGER credit3
AFTER DELETE  ON studentcourse  -- 在删除后修改对应已修学分
FOR EACH ROW
BEGIN
	UPDATE student SET completedCredits=
	(SELECT sum(credit) as sum FROM course,courseclass,studentcourse WHERE
	studentcourse.studentID=old.studentID and 
	studentcourse.score>60 and 
	studentcourse.courseClassID=courseclass.courseClassID and 
	course.courseID=courseclass.courseID);
END;
```

这一部分额外增加了三个触发器，用于在学生选课表更新插入删除后实时修改学生表里的已修学分属性

该属性要求学生成绩大于60分才可以获得某一门课程的学分

# 四、数据库后端实现

## 1.环境要求

编辑器：IDEA

数据库：mysql

语言：java 8

接口测试工具：postman

## 2.项目整体架构

数据库后端项目基于**Spring boot**，整体分为三层。

- 数据持久层

  目的是在java对象与数据库之间建立映射，也就是说它的作用是将某一个Java类对应到数据库中的一张表。在我们的项目中，就将创建一个实体类User映射到数据库的user表，表中的每个字段对应于实体类的每个属性。

  - domain：存放实体类的包，比如User类，其作为对应数据库user表的一个实体类。

  - repository: 存放一些数据访问类（也就是一些能操纵数据库的类）的包，比如存放能对user表进行增删改查的类，这一层也仅仅就是基础的增删改查，不附带额外的业务逻辑。

- 业务逻辑层

  作用是处理业务逻辑。比如在本项目中，我们就在业务逻辑层实现具体插入删除的逻辑，像是插入person要连带着插入user等逻辑都写在这里。

  - service: 存放业务逻辑接口的包。
  - serviceImpl: 存放业务逻辑实现类的包，其中的类实现service中的接口。

- 控制层

  作用是接收视图层的请求并调用业务逻辑层的方法。比如视图层请求插入用户并发来了用户的信息，那么控制层就调用业务逻辑层的登录方法，并将用户信息作为参数传入，在将结果返回给视图层。

  - controller: 存放控制器的包。比如UserController

**同时包括额外的包：**

- security包

  基于Spring Security+JWT，提供用户登录，用户认证，和基于角色的权限控制等功能。

- config包

  提供了跨域配置、安全配置等。

- utils包

  提供了统一输出结构的工具类等。

。![20210630010734](数据库课程报告/20210630010734-16541636966865.png)

可以发现这样一个架构就是自底向上的，所以下面我们按照自底向上来创建项目。

### 2.1 数据持久层

**实体**

构建与数据表对应的数据实体

 ![image-20220602174816807](数据库课程报告/image-20220602174816807.png)

**dao**

实现各个数据表基本的增删改查操作

 ![image-20220602174844116](数据库课程报告/image-20220602174844116.png)

### 2.2 业务逻辑层

通过调用dao层基本的增删改查操作实现每一个模块具体的业务逻辑

 ![image-20220602175002591](数据库课程报告/image-20220602175002591-16541634052311.png)

### 2.3 控制层

调用业务逻辑层的实现，实现后端接口，将接口暴露给前端

 ![image-20220602180239610](数据库课程报告/image-20220602180239610.png)

### 2.4 security

实现用户登录验证，基于角色的权限控制等功能

 ![image-20220602180551639](数据库课程报告/image-20220602180551639.png)

#### 2.4.1 Spring Security

Spring Security 是一个专注于为 Java 应用程序提供身份验证和授权的框架。与所有 Spring 项目一样，Spring Security 的真正强大之处在于它可以轻松扩展以满足自定义需求。

**特性：**

- 支持对身份认证和访问鉴权的自定义扩展
- 防止会话固定、点击劫持、跨站点请求伪造等攻击
- Servlet API 集成
- 与 Spring Web MVC 的可选集成

从官方的介绍来说，Spring Security的核心是提供认证（Authentication）、授权（Authorization）和攻击防护。

#### 2.4.2 JWT

**利用token进行用户身份验证的流程：**

- 客户端使用用户名和密码请求登录

- 服务端收到请求，验证用户名和密码

- 验证成功后，服务端会签发一个token，再把这个token返回给客户端

- 客户端收到token后可以把它存储起来，比如放到cookie中

- 客户端每次向服务端请求资源时需要携带服务端签发的token，可以在cookie或者header中携带

- 服务端收到请求，然后去验证客户端请求里面带着的token，如果验证成功，就向客户端返回请求数据

这种基于token的认证方式相比传统的session认证方式更节约服务器资源，并且对移动端和分布式更加友好。其优点如下：

- 支持跨域访问：cookie是无法跨域的，而token由于没有用到cookie(前提是将token放到请求头中)，所以跨域后不会存在信息丢失问题
- 无状态：token机制在服务端不需要存储session信息，因为token自身包含了所有登录用户的信息，所以可以减轻服务端压力
- 更适用CDN：可以通过内容分发网络请求服务端的所有资料
- 更适用于移动端：当客户端是非浏览器平台时，cookie是不被支持的，此时采用token认证方式会简单很多
- 无需考虑CSRF：由于不再依赖cookie，所以采用token认证方式不会发生CSRF，所以也就无需考虑CSRF的防御

而JWT就是上述流程当中token的一种具体实现方式，其全称是JSON Web Token。

通俗地说，JWT的本质就是一个字符串，它是将用户信息保存到一个Json字符串中，然后进行编码后得到一个JWT token，并且这个JWT token带有签名信息，接收后可以校验是否被篡改，所以可以用于在各方之间安全地将信息作为Json对象传输。

JWT的认证流程如下：

- 首先，前端通过Web表单将自己的用户名和密码发送到后端的接口，这个过程一般是一个POST请求。建议的方式是通过SSL加密的传输(HTTPS)，从而避免敏感信息被嗅探
- 后端核对用户名和密码成功后，将包含用户信息的数据作为JWT的Payload，将其与JWT Header分别进行Base64编码拼接后签名，形成一个JWT Token，形成的JWT Token就是一个如同lll.zzz.xxx的字符串
- 后端将JWT Token字符串作为登录成功的结果返回给前端。前端可以将返回的结果保存在浏览器中，退出登录时删除保存的JWT Token即可
- 前端在每次请求时将JWT Token放入HTTP请求头中的Authorization属性中(解决XSS和XSRF问题)
- 后端检查前端传过来的JWT Token，验证其有效性，比如检查签名是否正确、是否过期、token的接收方是否是自己等等
- 验证通过后，后端解析出JWT Token中包含的用户信息，进行其他逻辑操作(一般是根据用户信息得到权限等)，返回结果

![img](数据库课程报告/900b3e81f832b2f08c2e8aabb540536a.png)

#### 2.4.3 RBAC模型

我们使用RBAC（Role-Based Access Control，基于角色的访问控制）模型设计用户，角色和权限间的关系。

在这种模型中，用户与角色之间，角色与权限之间，是多对多的关系。

|   数据表名    |     中文表名     | 备注说明 |
| :-----------: | :--------------: | :------: |
|   sys_user    |    系统用户表    |  基础表  |
|   sys_menu    |      权限表      |  基础表  |
|   sys_role    |      角色表      |  基础表  |
| sys_role_menu | 角色与权限关系表 |  中间表  |
| sys_user_role | 用户与角色关系表 |  中间表  |

#### 2.4.4 基于RBAC的数据库配置

建表：

```mysql
CREATE TABLE `sys_menu` (
  `menu_id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'ID',
  `name` varchar(50) NOT NULL COMMENT '权限名称',
  `permission` varchar(200) DEFAULT NULL COMMENT '权限标识',
  PRIMARY KEY (`menu_id`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=87 DEFAULT CHARSET=utf8 ROW_FORMAT=DYNAMIC COMMENT='权限表';
CREATE TABLE `sys_role` (
  `role_id` bigint(11) NOT NULL AUTO_INCREMENT COMMENT '角色ID',
  `role_name` varchar(50) NOT NULL COMMENT '角色名称',
  PRIMARY KEY (`role_id`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8 ROW_FORMAT=DYNAMIC COMMENT='角色表';
CREATE TABLE `sys_role_menu` (
  `id` bigint(11) NOT NULL AUTO_INCREMENT COMMENT 'ID',
  `role_id` bigint(11) DEFAULT NULL COMMENT '角色ID',
  `menu_id` bigint(11) DEFAULT NULL COMMENT '权限ID',
  PRIMARY KEY (`id`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8 ROW_FORMAT=DYNAMIC COMMENT='角色与权限关系表';
CREATE TABLE `sys_user` (
  `user_id` bigint(11) NOT NULL AUTO_INCREMENT COMMENT '用户ID',
  `username` varchar(50) NOT NULL COMMENT '用户名',
  `password` varchar(100) DEFAULT NULL COMMENT '密码',
  `status` varchar(10) DEFAULT NULL COMMENT '状态 PROHIBIT：禁用   NORMAL：正常',
  PRIMARY KEY (`user_id`) USING BTREE,
  UNIQUE KEY `username` (`username`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=7 DEFAULT CHARSET=utf8 ROW_FORMAT=DYNAMIC COMMENT='系统用户表';
CREATE TABLE `sys_user_role` (
  `id` bigint(11) NOT NULL AUTO_INCREMENT COMMENT 'ID',
  `user_id` bigint(11) DEFAULT NULL COMMENT '用户ID',
  `role_id` bigint(11) DEFAULT NULL COMMENT '角色ID',
  PRIMARY KEY (`id`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8 ROW_FORMAT=DYNAMIC COMMENT='用户与角色关系表';
```

建立3个角色：管理员、学生、教师

```mysql
INSERT INTO `sys_role` VALUES (1, 'ADMIN');
INSERT INTO `sys_role` VALUES (2, 'STUDENT');
INSERT INTO `sys_role` VALUES (3, 'TEACHER');
```

### 2.5 配置文件

application.yml

```yml
# 配置端口
server:
  port: 8081
spring:
  # 配置数据源
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/databaselab?serverTimezone=UTC
    username: root
    password: wyh12345678
# JWT配置
jwt:
  # 密匙KEY
  secret: JWTSecret
  # HeaderKEY
  tokenHeader: Authorization
  # Token前缀字符
  tokenPrefix:
  # 过期时间 单位秒 1天后过期=86400 7天后过期=604800
  expiration: 86400
  # 配置不需要认证的接口
  antMatchers: /index/**,/favicon.ico,/admin/adminRegister,/user/login,/user/logout,/user/loginRequire
# Mybatis-plus相关配置
mybatis-plus:
  # xml扫描，多个目录用逗号或者分号分隔（告诉 Mapper 所对应的 XML 文件位置）
  mapper-locations: classpath:mapper/*.xml
  # 以下配置均有默认值,可以不设置
  global-config:
    db-config:
      #主键类型 AUTO:"数据库ID自增" INPUT:"用户输入ID",ID_WORKER:"全局唯一ID (数字类型唯一ID)", UUID:"全局唯一ID UUID";
      id-type: AUTO
      #字段策略 IGNORED:"忽略判断"  NOT_NULL:"非 NULL 判断")  NOT_EMPTY:"非空判断"
      field-strategy: NOT_EMPTY
      #数据库类型
      db-type: MYSQL
  configuration:
    # 是否开启自动驼峰命名规则映射:从数据库列名到Java属性驼峰命名的类似映射
    map-underscore-to-camel-case: true
    # 返回map时true:当查询数据为空时字段返回为null,false:不加这个查询数据为空时，字段将被隐藏
    call-setters-on-nulls: true
    # 这个配置会将执行的sql打印出来，在开发或测试的时候可以用
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
```







## 3.实现的关键类及注释

### 3.1 登录认证与基于角色的权限控制

#### 3.1.1 认证与权限基础类

##### JWT工具类

实现登录成功后token的生成

```java
/**
 * JWT工具类
 */
@Slf4j
public class JWTTokenUtil {

    /**
     * 私有化构造器
     */
    private JWTTokenUtil(){}

    /**
     * 生成Token
     */
    public static String createAccessToken(SelfUserEntity selfUserEntity){
        // 登陆成功生成JWT
        String token = Jwts.builder()
                // 放入用户名和用户ID
                .setId(selfUserEntity.getUserId()+"")
                // 主题
                .setSubject(selfUserEntity.getUsername())
                // 签发时间
                .setIssuedAt(new Date())
                // 签发者
                .setIssuer("HNU")
                // 自定义属性 放入用户拥有权限
                .claim("authorities", JSON.toJSONString(selfUserEntity.getAuthorities()))
                // 失效时间
                .setExpiration(new Date(System.currentTimeMillis() + JWTConfig.expiration))
                // 签名算法和密钥
                .signWith(SignatureAlgorithm.HS512, JWTConfig.secret)
                .compact();
        return token;
    }
}
```

##### 暂无权限处理类

``` java
@Component
public class UserAuthAccessDeniedHandler implements AccessDeniedHandler{
    /**
     * 暂无权限返回结果
     */
    @Override
    public void handle(HttpServletRequest request, HttpServletResponse response, AccessDeniedException exception) throws IOException {
        Result.responseJson(response,Result.resultCode("403","未授权"));
    }
}
```

##### 用户未登录处理类

```java
@Component
public class UserAuthenticationEntryPointHandler implements AuthenticationEntryPoint {
    /**
     * 用户未登录返回结果
     */
    @Override
    public void commence(HttpServletRequest request, HttpServletResponse response, AuthenticationException exception) throws IOException {
        Result.responseJson(response,Result.resultCode("401","未登录"));
    }
}
```

##### 登录失败处理类

```java
@Slf4j
@Component
public class UserLoginFailureHandler implements AuthenticationFailureHandler {
    /**
     * 登录失败返回结果
     */
    @Override
    public void onAuthenticationFailure(HttpServletRequest request, HttpServletResponse response, AuthenticationException exception) throws IOException {
        // 这些对于操作的处理类可以根据不同异常进行不同处理
        if (exception instanceof UsernameNotFoundException){
            log.info("【登录失败】"+exception.getMessage());
            Result.responseJson(response, Result.resultCode("500","用户名不存在"));
        }
        if (exception instanceof LockedException){
            log.info("【登录失败】"+exception.getMessage());
            Result.responseJson(response,Result.resultCode("500","用户被冻结"));
        }
        if (exception instanceof BadCredentialsException){
            log.info("【登录失败】"+exception.getMessage());
            Result.responseJson(response,Result.resultCode("500","用户名密码不正确"));
        }
        Result.responseJson(response,Result.resultCode("500","登录失败"));
    }
}
```

##### 登录成功处理类

```java
@Slf4j
@Component
public class UserLoginSuccessHandler implements AuthenticationSuccessHandler {
    /**
     * 登录成功返回结果
     */
    @Override
    public void onAuthenticationSuccess(HttpServletRequest request, HttpServletResponse response, Authentication authentication) throws IOException {
        // 组装JWT
        SelfUserEntity selfUserEntity =  (SelfUserEntity) authentication.getPrincipal();
        String token = JWTTokenUtil.createAccessToken(selfUserEntity);
        token = JWTConfig.tokenPrefix + token;
        // 封装返回参数
        Map<String,Object> resultData = new HashMap<>();
        resultData.put("code","200");
        resultData.put("message", "登录成功");
        Map<String, Object> data = new HashMap<>();
        data.put("token",token);
        data.put("role", SecurityUtil.getUserRole());
        resultData.put("data",data);
        Result.responseJson(response,resultData);
    }
}
```

##### 登出成功处理类

````java
@Component
public class UserLogoutSuccessHandler implements LogoutSuccessHandler {
    /**
     * 用户登出返回结果
     * 这里应该让前端清除掉Token
     */
    @Override
    public void onLogoutSuccess(HttpServletRequest request, HttpServletResponse response, Authentication authentication) throws IOException {
        SecurityContextHolder.clearContext();
        Result.responseJson(response, Result.resultCode("200","登出成功"));
    }
}
````

#### 3.1.2 SpringSecurity核心配置类

完成以下配置：

- 配置登录验证逻辑

- 不进行权限验证的请求或资源
- 未登录自定义处理类、登录成功自定义处理类、登录失败自定义处理类、用户登出自定义处理类、没有权限自定义处理类
- 配置登入地址、登出地址
- 因为是基于Token的，取消跨站请求伪造和session
- 添加JWT过滤器

```java
/**
 * SpringSecurity配置类
 */
@Configuration
@EnableWebSecurity
@EnableGlobalMethodSecurity(prePostEnabled = true) //开启权限注解,默认是关闭的
public class SecurityConfig extends WebSecurityConfigurerAdapter {
    /**
     * 自定义登录成功处理器
     */
    @Autowired
    private UserLoginSuccessHandler userLoginSuccessHandler;
    /**
     * 自定义登录失败处理器
     */
    @Autowired
    private UserLoginFailureHandler userLoginFailureHandler;
    /**
     * 自定义注销成功处理器
     */
    @Autowired
    private UserLogoutSuccessHandler userLogoutSuccessHandler;
    /**
     * 自定义暂无权限处理器
     */
    @Autowired
    private UserAuthAccessDeniedHandler userAuthAccessDeniedHandler;
    /**
     * 自定义未登录的处理器
     */
    @Autowired
    private UserAuthenticationEntryPointHandler userAuthenticationEntryPointHandler;
    /**
     * 自定义登录逻辑验证器
     */
    @Autowired
    private UserAuthenticationProvider userAuthenticationProvider;

    /**
     * 加密方式
     */
    @Bean
    public BCryptPasswordEncoder bCryptPasswordEncoder(){
        return new BCryptPasswordEncoder();
    }
    /**
     * 注入自定义PermissionEvaluator
     */
    @Bean
    public DefaultWebSecurityExpressionHandler userSecurityExpressionHandler(){
        DefaultWebSecurityExpressionHandler handler = new DefaultWebSecurityExpressionHandler();
        handler.setPermissionEvaluator(new UserPermissionEvaluator());
        return handler;
    }

    /**
     * 配置登录验证逻辑
     */
    @Override
    protected void configure(AuthenticationManagerBuilder auth){
        //这里可启用我们自己的登陆验证逻辑
        auth.authenticationProvider(userAuthenticationProvider);
    }
    /**
     * 配置security的控制逻辑
     */
    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http.authorizeRequests()
                // 不进行权限验证的请求或资源(从配置文件中读取)
               .antMatchers(JWTConfig.antMatchers.split(",")).permitAll()
                // 其他的需要登陆后才能访问
                .anyRequest().authenticated()
                .and()
                // 配置未登录自定义处理类
                .httpBasic().authenticationEntryPoint(userAuthenticationEntryPointHandler)
                .and()
                // 配置登录地址
                .formLogin()
                .loginProcessingUrl("/user/login")
                //若未登录，则向前端返回401
                .loginPage("/user/loginRequire")
                // 配置登录成功自定义处理类
                .successHandler(userLoginSuccessHandler)
                // 配置登录失败自定义处理类
                .failureHandler(userLoginFailureHandler)
                .and()
                // 配置登出地址
                .logout()
                .logoutUrl("/user/logout")
                // 配置用户登出自定义处理类
                .logoutSuccessHandler(userLogoutSuccessHandler)
                .and()
                // 配置没有权限自定义处理类
                .exceptionHandling().accessDeniedHandler(userAuthAccessDeniedHandler)
                .and()
                // 开启跨域
                .cors()
                .and()
                // 取消跨站请求伪造防护
                .csrf().disable();
        // 基于Token不需要session
        http.sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS);
        // 禁用缓存
        http.headers().cacheControl();
        // 添加JWT过滤器
        http.addFilter(new JWTAuthenticationTokenFilter(authenticationManager()));
    }
}
```

#### 3.1.3 JWT拦截类

```java
/**
 * JWT接口请求校验拦截器
 * 请求接口时会进入这里验证Token是否合法和过期
 */
@Slf4j
public class JWTAuthenticationTokenFilter extends BasicAuthenticationFilter {

    public JWTAuthenticationTokenFilter(AuthenticationManager authenticationManager) {
        super(authenticationManager);
    }

    @Override
    protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain) throws ServletException, IOException {
        // 获取请求头中JWT的Token
        String tokenHeader = request.getHeader(JWTConfig.tokenHeader);
        if (null!=tokenHeader && tokenHeader.startsWith(JWTConfig.tokenPrefix)) {
            try {
                // 截取JWT前缀
                String token = tokenHeader.replace(JWTConfig.tokenPrefix, "");
                // 解析JWT
                Claims claims = Jwts.parser()
                        .setSigningKey(JWTConfig.secret)
                        .parseClaimsJws(token)
                        .getBody();
                // 获取用户名
                String username = claims.getSubject();
                String userId=claims.getId();
                if(!StringUtils.isEmpty(username)&&!StringUtils.isEmpty(userId)) {
                    // 获取角色
                    List<GrantedAuthority> authorities = new ArrayList<>();
                    String authority = claims.get("authorities").toString();
                    if(!StringUtils.isEmpty(authority)){
                        List<Map<String,String>> authorityMap = JSONObject.parseObject(authority, List.class);
                        for(Map<String,String> role : authorityMap){
                            if(!StringUtils.isEmpty(role)) {
                                authorities.add(new SimpleGrantedAuthority(role.get("authority")));
                            }
                        }
                    }
                    //组装参数
                    SelfUserEntity selfUserEntity = new SelfUserEntity();
                    selfUserEntity.setUsername(claims.getSubject());
                    selfUserEntity.setUserId(Long.parseLong(claims.getId()));
                    selfUserEntity.setAuthorities(authorities);
                    UsernamePasswordAuthenticationToken authentication = new UsernamePasswordAuthenticationToken(selfUserEntity, userId, authorities);
                    SecurityContextHolder.getContext().setAuthentication(authentication);
                }
            } catch (ExpiredJwtException e){
                log.info("Token过期");
                response.setStatus(401);
            } catch (Exception e) {
                log.info("Token无效");
                response.setStatus(401);
            }
        }
        filterChain.doFilter(request, response);
        return;
    }
}
```

#### 3.1.4 自定义登录验证类

```java
@Component
public class UserAuthenticationProvider implements AuthenticationProvider {
    @Autowired
    private SelfUserDetailsService selfUserDetailsService;
    @Autowired
    private SysUserService sysUserService;

    @Override
    public Authentication authenticate(Authentication authentication) throws AuthenticationException {
        // 获取表单输入中返回的用户名
        String userName = (String) authentication.getPrincipal();
        // 获取表单中输入的密码
        String password = (String) authentication.getCredentials();
        // 查询用户是否存在
        SelfUserEntity userInfo = selfUserDetailsService.loadUserByUsername(userName);
        if (userInfo == null) {
            throw new UsernameNotFoundException("用户名不存在");
        }
        // 我们还要判断密码是否正确，这里我们的密码使用BCryptPasswordEncoder进行加密的
        if (!new BCryptPasswordEncoder().matches(password, userInfo.getPassword())) {
            throw new BadCredentialsException("密码不正确");
        }
        // 还可以加一些其他信息的判断，比如用户账号已停用等判断
        if (userInfo.getStatus().equals("PROHIBIT")){
            throw new LockedException("该用户已被冻结");
        }
        // 角色集合
        Set<GrantedAuthority> authorities = new HashSet<>();
        // 查询用户角色
        List<SysRoleEntity> sysRoleEntityList = sysUserService.selectSysRoleByUserId(userInfo.getUserId());
        for (SysRoleEntity sysRoleEntity: sysRoleEntityList){
            authorities.add(new SimpleGrantedAuthority("ROLE_"+sysRoleEntity.getRoleName()));
        }
        userInfo.setAuthorities(authorities);
        // 进行登录
        return new UsernamePasswordAuthenticationToken(userInfo, password, authorities);
    }
    @Override
    public boolean supports(Class<?> authentication) {
        return true;
    }
}
```

#### 3.1.5 自定义权限注解验证类

```java
@Component
public class UserAuthenticationProvider implements AuthenticationProvider {
    @Autowired
    private SelfUserDetailsService selfUserDetailsService;
    @Autowired
    private SysUserService sysUserService;

    @Override
    public Authentication authenticate(Authentication authentication) throws AuthenticationException {
        // 获取表单输入中返回的用户名
        String userName = (String) authentication.getPrincipal();
        // 获取表单中输入的密码
        String password = (String) authentication.getCredentials();
        // 查询用户是否存在
        SelfUserEntity userInfo = selfUserDetailsService.loadUserByUsername(userName);
        if (userInfo == null) {
            throw new UsernameNotFoundException("用户名不存在");
        }
        // 我们还要判断密码是否正确，这里我们的密码使用BCryptPasswordEncoder进行加密的
        if (!new BCryptPasswordEncoder().matches(password, userInfo.getPassword())) {
            throw new BadCredentialsException("密码不正确");
        }
        // 还可以加一些其他信息的判断，比如用户账号已停用等判断
        if (userInfo.getStatus().equals("PROHIBIT")){
            throw new LockedException("该用户已被冻结");
        }
        // 角色集合
        Set<GrantedAuthority> authorities = new HashSet<>();
        // 查询用户角色
        List<SysRoleEntity> sysRoleEntityList = sysUserService.selectSysRoleByUserId(userInfo.getUserId());
        for (SysRoleEntity sysRoleEntity: sysRoleEntityList){
            authorities.add(new SimpleGrantedAuthority("ROLE_"+sysRoleEntity.getRoleName()));
        }
        userInfo.setAuthorities(authorities);
        // 进行登录
        return new UsernamePasswordAuthenticationToken(userInfo, password, authorities);
    }
    @Override
    public boolean supports(Class<?> authentication) {
        return true;
    }
}
```

#### 3.1.6 SpringSecurity用户、角色、权限实体

##### 系统用户实体

```java
/**
 * 系统用户实体
 */
@Data
@TableName("sys_user")
public class SysUserEntity implements Serializable {
   private static final long serialVersionUID = 1L;
   /**
    * 用户ID
    */
   @TableId
   private Long userId;
   /**
    * 用户名
    */
   private String username;
   /**
    * 密码
    */
   private String password;
   /**
    * 状态:NORMAL正常  PROHIBIT禁用
    */
   private String status;
}
```

#####  角色实体

```java
/**
 * 角色实体
 */
@Data
@TableName("sys_role")
public class SysRoleEntity implements Serializable {
	private static final long serialVersionUID = 1L;
	/**
	 * 角色ID
	 */
	@TableId
	private Long roleId;
	/**
	 * 角色名称
	 */
	private String roleName;
}
```

##### 权限实体

```java
/**
 * 权限实体
 */
@Data
@TableName("sys_menu")
public class SysMenuEntity implements Serializable {
    private static final long serialVersionUID = 1L;

    /**
     * 权限ID
     */
    @TableId
    private Long menuId;
    /**
     * 权限名称
     */
    private String name;
    /**
     * 权限标识
     */
    private String permission;

}

```

##### 角色与权限关系实体

```java
/**
 *角色与权限关系实体
 */
@Data
@TableName("sys_role_menu")
public class SysRoleMenuEntity implements Serializable {
	private static final long serialVersionUID = 1L;
	/**
	 * ID
	 */
	@TableId
	private Long id;
	/**
	 * 角色ID
	 */
	private Long roleId;
	/**
	 * 权限ID
	 */
	private Long menuId;
}

```

##### 用户与角色关系实体

```java
/**
 * 用户与角色关系实体
 */
@Data
@TableName("sys_user_role")
public class SysUserRoleEntity implements Serializable {
	private static final long serialVersionUID = 1L;
	/**
	 * ID
	 */
	@TableId
	private Long id;
	/**
	 * 用户ID
	 */
	private Long userId;
	/**
	 * 角色ID
	 */
	private Long roleId;
}

```

#### 3.1.7 对用户、角色、权限相关实体的增删改查

- **在mapper/*.xml中实现，映射到dao层接口**

- 下面为有使用到的类

##### 角色DAO

```java
@Mapper
public interface SysRoleDao extends BaseMapper<SysRoleEntity> {

    /**
     * 根据角色名查找角色ID
     */
    Long selectRoleIdByRoleName(String username);
}
```

##### 系统用户DAO

```java
/**
 * 系统用户DAO
 */
@Mapper
public interface SysUserDao extends BaseMapper<SysUserEntity> {

    /**
     * 通过用户ID查询角色集合
     */
    List<SysRoleEntity> selectSysRoleByUserId(Long userId);

    /**
     * 通过用户ID查询权限集合
     */
    List<SysMenuEntity> selectSysMenuByUserId(Long userId);

    /**
     * 通过用户名查询用户集合
     */
    List<SysUserEntity> selectSysUserByUsername(String username);

    /**
     * 更新指定用户名的密码
     * map：username,password
     */
    void updatePasswordByUsername(Map<String, Object> map);

    /**
     * 通过用户名查询用户ID
     */
    Long selectUserIdByUserName(String username);

    /**
     * 通过用户ID删除用户
     */
    void deleteUserByUserId(Long userId);
}
```

##### 用户与角色关系DAO

```java
@Mapper
public interface SysUserRoleDao extends BaseMapper<SysUserRoleEntity> {
    void myInsert(Map<String, Long> map);
    void myDelete(Map<String, Long> map);
}
```

#### 3.1.8 认证与权限相关的Impl

登录和登出的接口已在SpringSecurity中配置

##### 管理员 AdminImpl

接口

```java
public interface AdminService {
    int adminRegister(String username, String password, String code);

    int studentRegister(String username, String password);

    int teacherRegister(String username, String password);

    int userRegister(String username, String password, String role);


    Map<Object, Object> selectSysUserRoleByUsername(Map<Object, Object> map, int pageIndex, int pageSize);

    int deleteRoleByUsername(Map<Object, Object> map);

    int insertRoleByUsername(Map<Object, Object> map);
}
```

接口实现

```java
@Service
public class AdminServiceImpl implements AdminService {
    BCryptPasswordEncoder bCryptPasswordEncoder = new BCryptPasswordEncoder();
    @Autowired
    private JdbcTemplate jdbcTemplate;
    @Resource
    private SysUserDao sysUserDao;
    @Resource
    private SysRoleDao sysRoleDao;
    @Resource
    private SysUserService sysUserService;
    @Resource
    private SysUserRoleService sysUserRoleService;
    @Resource
    private StudentDao studentDao;
    @Resource
    private TeacherDao teacherDao;
    @Resource
    private SysUserRoleDao sysUserRoleDao;

    /**
     * 注册管理员
     *
     * @return 0:成功, 1:失败，邀请码无效
     */
    @Override
    public int adminRegister(String username, String password, String code) {
        if (sysUserDao.selectSysUserByUsername(username).size() > 0) {
            return 2;
        }
        //验证邀请码
        if (!Objects.equals(code, "hnu123456"))
            return 1;
        // 注册用户
        SysUserEntity sysUserEntity = new SysUserEntity();
        sysUserEntity.setUsername(username);
        sysUserEntity.setPassword(bCryptPasswordEncoder.encode(password));
        // 设置用户状态
        sysUserEntity.setStatus("NORMAL");
        sysUserService.save(sysUserEntity);
        // 分配角色
        SysUserRoleEntity sysUserRoleEntity = new SysUserRoleEntity();
        sysUserRoleEntity.setRoleId(1L);
        sysUserRoleEntity.setUserId(sysUserEntity.getUserId());
        sysUserRoleService.save(sysUserRoleEntity);
        return 0;
    }

    /**
     * 注册学生用户
     *
     * @return 0:成功, 1:失败，该用户名已存在
     */
    @Override
    public int studentRegister(String username, String password) {
        // 注册用户
        SysUserEntity sysUserEntity = new SysUserEntity();
        sysUserEntity.setUsername(username);
        sysUserEntity.setPassword(bCryptPasswordEncoder.encode(password));
        // 设置用户状态
        sysUserEntity.setStatus("NORMAL");
        int num = sysUserDao.selectSysUserByUsername(username).size();
        if (num > 0)
            return 1;
        sysUserService.save(sysUserEntity);
        SysUserRoleEntity sysUserRoleEntity = new SysUserRoleEntity();
        sysUserRoleEntity.setRoleId(2L);
        sysUserRoleEntity.setUserId(sysUserEntity.getUserId());
        sysUserRoleService.save(sysUserRoleEntity);
        return 0;
    }

    /**
     * 注册教师用户
     *
     * @return 0:成功, 1:失败，该用户名已存在
     */
    @Override
    public int teacherRegister(String username, String password) {
        // 注册用户
        SysUserEntity sysUserEntity = new SysUserEntity();
        sysUserEntity.setUsername(username);
        sysUserEntity.setPassword(bCryptPasswordEncoder.encode(password));
        // 设置用户状态
        sysUserEntity.setStatus("NORMAL");
        int num = sysUserDao.selectSysUserByUsername(username).size();
        if (num > 0)
            return 1;
        sysUserService.save(sysUserEntity);
        SysUserRoleEntity sysUserRoleEntity = new SysUserRoleEntity();
        sysUserRoleEntity.setRoleId(3L);
        sysUserRoleEntity.setUserId(sysUserEntity.getUserId());
        sysUserRoleService.save(sysUserRoleEntity);
        return 0;
    }

    /**
     * 注册普通用户
     *
     * @return 0:成功, 1:失败，该学生不存在, 2:失败，该教师不存在，3:失败，该用户名已存在, 4:失败，没有该角色
     */
    @Override
    public int userRegister(String username, String password, String role) {
        int num = sysUserDao.selectSysUserByUsername(username).size();
        if (num > 0)
            return 3;
        //查看角色
        if (Objects.equals(role, "STUDENT")) {
            int num2 = studentDao.getByID(username).size();
            if (num2 == 0)
                return 1;
            studentRegister(username, password);
            return 0;
        } else if (Objects.equals(role, "TEACHER")) {
            int num3 = teacherDao.getByID(username).size();
            if (num3 == 0)
                return 2;
            teacherRegister(username, password);
            return 0;
        }
        return 4;
    }

    /**
     * 根据用户名查找用户名-角色名
     * 若用户名为空，则查看全部
     */
    @Override
    public Map<Object, Object> selectSysUserRoleByUsername(Map<Object, Object> map, int pageIndex, int pageSize) {

        StringBuilder sql = new StringBuilder("SELECT sys_user.username,sys_role.role_name FROM sys_user,sys_role,sys_user_role  WHERE sys_user.user_id=sys_user_role.user_id and sys_role.role_id=sys_user_role.role_id ");
        //给出params
        List<Object> params = new ArrayList<>();
        if (map.get("username") != null) {
            String s = map.get("username").toString();
            if (s != null && !s.trim().isEmpty()) {
                sql.append(" and username = ?");
                params.add(s);
            }
        }
        sql.append(" ORDER BY username");
        //统计个数
        String sql2 = "SELECT count(*) as sum from (" + sql + ") as a;";
        int count = jdbcTemplate.queryForObject(sql2, Integer.class, params.toArray());
        //添加页数条目限制
        sql.append(" limit ?,?");
        params.add((pageIndex - 1) * pageSize);
        params.add(pageSize);

        Map<Object, Object> response = new HashMap<>();
        response.put("total", count);
        response.put("pageIndex", pageIndex);
        response.put("tableData", jdbcTemplate.queryForList(sql.toString(), params.toArray()));
        return response;
    }

    /**
     * 撤销某用户对应的某角色
     *
     * @param : username,roleName,superCode
     * @return: 0:成功，1:撤销了该用户唯一的角色，该用户被删除，2:授予的角色为“ADMIN”时,超级权限码不正确，3:该用户并无拥有该角色，无法撤销，4:不能撤销自己的管理员权限
     */
    @Override
    public int deleteRoleByUsername(Map<Object, Object> map) {
        String roleName = map.get("roleName").toString();
        Map<Object, Object> cur = selectSysUserRoleByUsername(map, 1, 3);
        List<Map<String, Object>> list = (List<Map<String, Object>>) cur.get("tableData");
        Map<String, Long> mapId = new HashMap<>();
        Long userId = sysUserDao.selectUserIdByUserName(map.get("username").toString());
        Long roleId = sysRoleDao.selectRoleIdByRoleName(map.get("roleName").toString());
        mapId.put("userId", userId);
        mapId.put("roleId", roleId);
        int flag = 1;
        for (Map<String, Object> stringObjectMap : list) {
            String roleName1 = stringObjectMap.get("role_name").toString();
            if (Objects.equals(roleName, roleName1)) {
                flag = 0;
                break;
            }
        }
        if (flag == 1)
            return 3;
        if (Objects.equals(roleName, "ADMIN")) {
            if (Objects.equals(userId, SecurityUtil.getUserId())) {
                return 4;
            }
            if (map.get("superCode") == null)
                return 2;
            String superCode = map.get("superCode").toString();
            if (!Objects.equals(superCode, "hnu123456")) {
                return 2;
            }
        }
        sysUserRoleDao.myDelete(mapId);
        int total = (int) cur.get("total");
        if (total == 1) {
            sysUserDao.deleteUserByUserId(userId);
            return 1;
        }
        return 0;
    }

    /**
     * 授予教师管理员角色
     *
     * @param : map(username,roleName,superCode)
     * @return: 0:成功，1:该用户已经有该角色，无法授予，2:授予的权限为“ADMIN”时,超级权限码不正确，3:无法授予非管理员角色，4:无法授予学生和管理员额外的角色
     */
    @Override
    public int insertRoleByUsername(Map<Object, Object> map) {
        String roleName = map.get("roleName").toString();
        Long userId = sysUserDao.selectUserIdByUserName(map.get("username").toString());
        Long roleId = sysRoleDao.selectRoleIdByRoleName(map.get("roleName").toString());
        List<Map<String, Object>> list = (List<Map<String, Object>>) selectSysUserRoleByUsername(map, 1, 3).get("tableData");
        for (Map<String, Object> stringObjectMap : list) {
            String roleName1 = stringObjectMap.get("role_name").toString();
            if (Objects.equals(roleName, roleName1)) {
                return 1;
            } else if (Objects.equals(roleName1, "ADMIN") || Objects.equals(roleName1, "STUDENT")) {
                return 4;
            }
        }
        if (Objects.equals(roleName, "ADMIN")) {
            if (map.get("superCode") == null)
                return 2;
            String superCode = map.get("superCode").toString();
            if (!Objects.equals(superCode, "hnu123456")) {
                return 2;
            }
        }
        if (!Objects.equals(roleName, "ADMIN")) {
            return 3;
        }
        Map<String, Long> mapId = new HashMap<>();
        mapId.put("userId", userId);
        mapId.put("roleId", roleId);
        sysUserRoleDao.myInsert(mapId);
        return 0;
    }
}
```

#####  普通用户 UserImpl

接口

```java
public interface UserService {
    int changePassword(Map<String, String> map);
}
```

接口实现

```java
@Service
public class UserServiceImpl implements UserService {
    BCryptPasswordEncoder bCryptPasswordEncoder = new BCryptPasswordEncoder();

    @Resource
    private SysUserDao sysUserDao;

    @Resource
    private SelfUserDetailsService selfUserDetailsService;

    /**
     * 当前用户修改密码
     * @return 0:成功, 1:失败，原密码错误
     */
    @Override
    public int changePassword(Map<String, String> map)
    {
        String oldPassword=map.get("oldPassword");
        String newPassword=map.get("newPassword");
        String userName=getUserName();
        SelfUserEntity userInfo = selfUserDetailsService.loadUserByUsername(userName);
        if (!bCryptPasswordEncoder.matches(oldPassword, userInfo.getPassword())) {
            return 1;
        }
        else
        {
            Map<String, Object> map2 = new HashMap<>();
            map2.put("username",userName);
            map2.put("password",bCryptPasswordEncoder.encode(newPassword));
            sysUserDao.updatePasswordByUsername(map2);
            return 0;
        }
    }
```

### 3.2 校建管理

#### 3.2.1 院系管理

##### Faculty实体

```java
@Table(name = "Faculty")
@Entity
public class Faculty {
    private String facultyName;
    @Id
    private String facultyCode;
    private String facultyAddress;
    private String facultyTeleno;

    public Faculty() {
    }

    public Faculty(String facultyName, String facultyCode, String facultyAddress, String facultyTeleno) {
        this.facultyName = facultyName;
        this.facultyCode = facultyCode;
        this.facultyAddress = facultyAddress;
        this.facultyTeleno = facultyTeleno;
    }

    public String getFacultyName() {
        return facultyName;
    }

    public void setFacultyName(String facultyName) {
        this.facultyName = facultyName;
    }

    public String getFacultyCode() {
        return facultyCode;
    }

    public void setFacultyCode(String facultyCode) {
        this.facultyCode = facultyCode;
    }

    public String getFacultyAddress() {
        return facultyAddress;
    }

    public void setFacultyAddress(String facultyAddress) {
        this.facultyAddress = facultyAddress;
    }

    public String getFacultyTeleno() {
        return facultyTeleno;
    }

    public void setFacultyTeleno(String facultyTeleno) {
        this.facultyTeleno = facultyTeleno;
    }
}

```

##### FacultyDao

实现基本的数据库增删改查操作



```java
@Repository
public class FacultyDao {
    @Autowired
    private JdbcTemplate jdbcTemplate;
    
    /**
     * 插入
     * @param faculty 院系实体
     */
    public void insert(Faculty faculty) {
        String sql="insert into faculty values (?,?,?,?)";
        jdbcTemplate.update(sql,
                faculty.getFacultyName(),
                faculty.getFacultyCode(),
                faculty.getFacultyAddress(),
                faculty.getFacultyTeleno());
    }

    /**
     * 删除
     * @param facultyCode 院系代码
     */
    public void delete(String facultyCode) {
        String sql="delete from Faculty where facultyCode = ?";
        jdbcTemplate.update(sql, facultyCode);
    }

    /**
     * 更新
     * @param faculty 院系实体
     */
    public void update(Faculty faculty) {
        String sql="UPDATE faculty SET facultyName=?,facultyAddress=?, facultyTeleno=? WHERE facultyCode=?";
        jdbcTemplate.update(sql,
                faculty.getFacultyName(),
                faculty.getFacultyAddress(),
                faculty.getFacultyTeleno(),
                faculty.getFacultyCode());
    }

    /**
     * 按Code查询
     */
    public List<Faculty> getByCode(String code) {
        String sql="select * from faculty where facultyCode=?";
        return jdbcTemplate.query(sql, (rs, rowNum) -> new Faculty(
                rs.getString("facultyName"),
                rs.getString("facultyCode"),
                rs.getString("facultyAddress"),
                rs.getString("facultyTeleno")
        ),code);
    }

    /**
     * 按某一个属性查询
     * @param attribute 要查询的属性
     * @param name 要查询的属性值
     * @return 查询结果
     */
    public List<Faculty> getByAttribute(String attribute,String name) {
        String sql="select * from faculty where "+attribute+" like ?";
        return jdbcTemplate.query(sql, (rs, rowNum) -> new Faculty(
                rs.getString("facultyName"),
                rs.getString("facultyCode"),
                rs.getString("facultyAddress"),
                rs.getString("facultyTeleno")
        ),name);
    }

    /**
     * 多条件模糊查询
     * @param faculty 院系实体
     * @param pageIndex 起始页
     * @param pageSize  每页个数
     * @return result
     */
    public Map<Object, Object> query(Faculty faculty, int pageIndex, int pageSize){
        //给出sql模板,为了便于后面添加sql语句
        StringBuilder sql =new StringBuilder("select * from faculty where 1=1");
        //给出params
        List<Object> params = new ArrayList<>();
        //构造查询语句
        String facultyName = faculty.getFacultyName();
        if(facultyName != null && !facultyName.trim().isEmpty()){
            sql.append(" and facultyName like ?");
            params.add("%" +facultyName+ "%");
        }
        String facultyCode= faculty.getFacultyCode();
        if(facultyCode != null && !facultyCode.trim().isEmpty()){
            sql.append(" and facultyCode like ?");
            params.add("%" +facultyCode+ "%");
        }

        String facultyAddress= faculty.getFacultyAddress();
        if(facultyAddress != null && !facultyAddress.trim().isEmpty()){
            sql.append(" and facultyAddress like ?");
            params.add("%" +facultyAddress+ "%");
        }

        String facultyTeleno= faculty.getFacultyTeleno();
        if(facultyTeleno != null && !facultyTeleno.trim().isEmpty()){
            sql.append(" and facultyTeleno like ?");
            params.add("%" +facultyTeleno+ "%");
        }
        //统计个数
        String sql2="SELECT count(*) as sum from ("+ sql +") as a;";
        int count=jdbcTemplate.queryForObject(sql2, Integer.class,params.toArray());
        //添加页数条目限制
        sql.append(" limit ?,?");
        params.add((pageIndex-1)*pageSize);
        params.add(pageSize);



        Map<Object, Object> response=new HashMap<>();
        response.put("total",count);
        response.put("pageIndex",pageIndex);
        response.put("tableData",jdbcTemplate.query(sql.toString(), (rs, rowNum) -> new Faculty(
                rs.getString("facultyName"),
                rs.getString("facultyCode"),
                rs.getString("facultyAddress"),
                rs.getString("facultyTeleno")
        ),params.toArray()));

        return response;
    }
}

```

##### FacultyImpl

接口

```java
@Service
public interface FacultyService {
    boolean insert(Faculty faculty);

    int delete(String facultyCode);

    boolean update(Faculty faculty);
    
    Map<Object, Object> query(Faculty faculty, int pageIndex, int pageSize);
}

```

接口实现

```java
@Service
public class FacultyServiceImpl  implements FacultyService {
    @Resource
    private FacultyDao facultyDao;
    @Resource
    private MajorDao majorDao;
    /**
     * 插入
     * @param faculty 院系实体
     * @return 执行结果
     */
    @Override
    public boolean insert(Faculty faculty) {
        int num=facultyDao.getByCode(faculty.getFacultyCode()).size();
        if(num==0){
            facultyDao.insert(faculty);
            return true;
        }
        else {
            return false;
        }
    }
    /**
     * 删除
     * @param facultyCode 院系代码
     * @return int 0成功,1失败
     */
    @Override
    public int delete(String facultyCode) {
        int num=facultyDao.getByCode(facultyCode).size();
        int majorNum=majorDao.getByAttribute("facultyCode",facultyCode).size();
        if(num!=0){
            if(majorNum==0){
                facultyDao.delete(facultyCode);
                return 0;
            }
            else{
                return 1;//该院系下专业非空，无法删除
            }
        }
        else {
            return 2;//院系不存在
        }
    }
    /**
     * 更新
     * @param faculty 院系实体
     * @return int 0成功,1失败
     */
    @Override
    public boolean update(Faculty faculty) {
        int num=facultyDao.getByCode(faculty.getFacultyCode()).size();
        if(num!=0){
            facultyDao.update(faculty);
            return true;
        }
        else {
            return false;
        }
    }
    /**
     * 多条件查询
     * @param faculty 院系实体
     * @return result list
     */
    @Override
    public Map<Object, Object> query(Faculty faculty, int pageIndex, int pageSize){
        return facultyDao.query(faculty,pageIndex,pageSize);
    }
}

```

##### FacultyController

```java
@RestController
@RequestMapping("/faculty")
public class FacultyController {
    @Resource
    private FacultyService facultyService;
    @PreAuthorize("hasRole('ADMIN')")
    @PostMapping("/insert")
    public Result<Faculty> insertController(@RequestBody Faculty faculty){
        if(facultyService.insert(faculty)){
            return Result.success(faculty);
        }
        else{
            return Result.error("1","当前记录已存在，插入失败！");
        }
    }
    @PreAuthorize("hasRole('ADMIN')")
    @PostMapping("/update")
    public Result<Faculty> deleteController(@RequestBody Faculty faculty){
        if(facultyService.update(faculty)){
            return Result.success(faculty);
        }
        else{
            return Result.error("1","当前记录不存在，无法更新！");
        }
    }
    @PreAuthorize("hasRole('ADMIN')")
    @PostMapping("/delete")
    public Result<String> updateController(@RequestParam String facultyCode){
        int r=facultyService.delete(facultyCode);
        if(r==0){
            return Result.success(facultyCode);
        }
        else if(r==1){
            return Result.error("1","该院系下专业非空，无法删除");
        }
        else{
            return Result.error("1","当前记录不存在，删除失败！");
        }
    }

    @PostMapping("/query")
    public Result<Map<Object, Object>> queryController(@RequestBody Faculty faculty, @RequestParam int pageIndex, @RequestParam int pageSize){
        Map<Object, Object> response =facultyService.query(faculty,pageIndex,pageSize);
        if((int)response.get("total")!=0){
            return Result.success(response,"查询成功");
        }else{
            return Result.error("1","查询结果为空");
        }
    }



}

```

#### 3.2.2 专业管理

##### Major实体

```java
@Table(name = "Major")
@Entity
public class Major {
    private String majorName;
    @Id
    private String majorCode;
    private String facultyCode;
    private String degreeLevel;
    private String graduationCredits;

    public Major() {

    }

    public Major(String majorName, String majorCode, String facultyCode, String degreeLevel, String graduationCredits) {
        this.majorName = majorName;
        this.majorCode = majorCode;
        this.facultyCode = facultyCode;
        this.degreeLevel = degreeLevel;
        this.graduationCredits = graduationCredits;
    }

    public String getMajorName() {
        return majorName;
    }

    public void setMajorName(String majorName) {
        this.majorName = majorName;
    }

    public String getMajorCode() {
        return majorCode;
    }

    public void setMajorCode(String majorCode) {
        this.majorCode = majorCode;
    }

    public String getFacultyCode() {
        return facultyCode;
    }

    public void setFacultyCode(String facultyCode) {
        this.facultyCode = facultyCode;
    }

    public String getDegreeLevel() {
        return degreeLevel;
    }

    public void setDegreeLevel(String degreeLevel) {
        this.degreeLevel = degreeLevel;
    }

    public String getGraduationCredits() {
        return graduationCredits;
    }

    public void setGraduationCredits(String graduationCredits) {
        this.graduationCredits = graduationCredits;
    }
}

```

##### MajorDao

```java
@Repository
public class MajorDao {
    @Autowired
    private JdbcTemplate jdbcTemplate;

    /**
     * 插入
     * @param major 专业实体
     */
    public void insert(Major major) {
        String sql="insert into major values (?,?,?,?,?)";
        jdbcTemplate.update(sql,
                major.getMajorName(),
                major.getMajorCode(),
                major.getFacultyCode(),
                major.getDegreeLevel(),
                major.getGraduationCredits());
    }

    /**
     * 删除
     * @param majorCode 专业代码
     */
    public void delete(String majorCode) {
        String sql="delete from major where majorCode = ?";
        jdbcTemplate.update(sql, majorCode);
    }

    /**
     * 更新
     * @param major 专业实体
     */
    public void update(Major major) {
        String sql="UPDATE major SET majorName=?,facultyCode=?, degreeLevel=? ,graduationCredits=? WHERE majorCode=?";
        jdbcTemplate.update(sql,
                major.getMajorName(),
                major.getFacultyCode(),
                major.getDegreeLevel(),
                major.getGraduationCredits(),
                major.getMajorCode());
    }

    /**
     * 按某一个属性查询
     * @param attribute 要查询的属性
     * @param name 要查询的属性值
     * @return 查询结果
     */
    public List<Major> getByAttribute(String attribute, String name) {
        String sql="select * from major where "+attribute+" like ?";
        return jdbcTemplate.query(sql, (rs, rowNum) -> new Major(
                rs.getString("majorName"),
                rs.getString("majorCode"),
                rs.getString("facultyCode"),
                rs.getString("degreeLevel"),
                rs.getString("graduationCredits")
        ),name);
    }

    /**
     * 按Code查询
     */
    public List<Major> getByCode(String code) {
        String sql="select * from major where majorCode=?";
        return jdbcTemplate.query(sql, (rs, rowNum) -> new Major(
                rs.getString("majorName"),
                rs.getString("majorCode"),
                rs.getString("facultyCode"),
                rs.getString("degreeLevel"),
                rs.getString("graduationCredits")
        ),code);
    }


    /**
     * 多条件模糊查询
     * @param major 专业实体
     * @param facultyName 要查询的院系名称
     * @param pageIndex 起始页
     * @param pageSize 每页个数
     * @return 查询结果
     */
    public Map<Object, Object> query(Major major,String facultyName,int pageIndex, int pageSize){
        //给出sql模板,为了便于后面添加sql语句
        StringBuilder sql =new StringBuilder("select faculty.facultyCode,facultyName,major.majorCode,majorName,degreeLevel,graduationCredits from major,faculty where major.facultyCode=faculty.facultyCode");
        //给出params
        List<Object> params = new ArrayList<>();
        //构造查询语句


        String majorName = major.getMajorName();
        if(majorName != null && !majorName.trim().isEmpty()){
            sql.append(" and majorName like ?");
            params.add("%" +majorName+ "%");
        }
        String majorCode= major.getMajorCode();
        if(majorCode != null && !majorCode.trim().isEmpty()){
            sql.append(" and majorCode like ?");
            params.add("%" +majorCode+ "%");
        }

        String facultyCode= major.getFacultyCode();
        if(facultyCode != null && !facultyCode.trim().isEmpty()){
            sql.append(" and major.facultyCode like ?");
            params.add("%" +facultyCode+ "%");
        }

        String degreeLevel= major.getDegreeLevel();
        if(degreeLevel != null && !degreeLevel.trim().isEmpty()){
            sql.append(" and degreeLevel like ?");
            params.add("%" +degreeLevel+ "%");
        }
        String graduationCredits= major.getGraduationCredits();
        if(graduationCredits != null && !graduationCredits.trim().isEmpty()){
            sql.append(" and graduationCredits like ?");
            params.add("%" +graduationCredits+ "%");
        }

        if(facultyName != null && !facultyName.trim().isEmpty()){
            sql.append(" and facultyName like ?");
            params.add("%" +facultyName+ "%");
        }

        //统计个数
        String sql2="SELECT count(*) as sum from ("+ sql +") as a;";
        int count=jdbcTemplate.queryForObject(sql2, Integer.class,params.toArray());
        //添加页数条目限制
        sql.append(" limit ?,?");
        params.add((pageIndex-1)*pageSize);
        params.add(pageSize);



        Map<Object, Object> response=new HashMap<>();
        response.put("total",count);
        response.put("pageIndex",pageIndex);
        response.put("tableData",jdbcTemplate.queryForList(sql.toString(), params.toArray()));

        return response;
    }
}

```

##### MajorImpl

接口

```java
@Service
public interface MajorService {
    int insert(Major major);

    int delete(String majorCode);

    int update(Major major);
    
    Map<Object, Object> query(Major major, String facultyName, int pageIndex, int pageSize);
}

```

接口实现

```java
@Service
public class MajorServiceImpl implements MajorService {
    @Resource
    private MajorDao majorDao;
    @Resource
    private FacultyDao facultyDao;
    @Resource
    private ClassDao classDao;
    /**
     * 插入
     * @param major 专业实体
     * @return 执行结果
     */
    @Override
    public int insert(Major major) {
        int num=majorDao.getByCode(major.getMajorCode()).size();
        int facultyNum=facultyDao.getByCode(major.getFacultyCode()).size();
        if(num==0){
            if(facultyNum!=0){
                majorDao.insert(major);
                return 0;//成功插入
            }
            else{
                return 1;//院系不存在，无法插入
            }
        }
        else {
            return 2;//当前专业已存在，无法插入
        }
    }
    /**
     * 删除
     * @param majorCode 专业代码
     * @return int 0成功,1失败
     */
    @Override
    public int delete(String majorCode) {
        int num=majorDao.getByCode(majorCode).size();
        int classNum=classDao.getByAttribute("majorCode",majorCode).size();
        if(num!=0){
            if(classNum==0){
                majorDao.delete(majorCode);
                return 0;
            }
            else {
                return 1;//该专业下班级非空，无法删除
            }
        }
        else {
            return 2;//专业不存在，无法删除
        }
    }


    /**
     * 更新
     * @param major 专业实体
     * @return int 0成功,1失败
     */
    @Override
    public int update(Major major) {
        int num=majorDao.getByCode(major.getMajorCode()).size();
        int facultyNum=facultyDao.getByCode(major.getFacultyCode()).size();
        if(num!=0){
            if(facultyNum!=0){
                majorDao.update(major);
                return 0;//成功更新
            }
            else{
                return 1;//院系不存在，无法更新
            }
        }
        else {
            return 2;//当前专业不存在，无法更新
        }
    }



    /**
     * 多条件查询
     * @param major 专业实体
     * @return result list
     */
    @Override
    public Map<Object, Object> query(Major major, String facultyName, int pageIndex, int pageSize){
        return majorDao.query(major,facultyName,pageIndex,pageSize);
    }
}

```

##### MajorController



```java
@RestController
@RequestMapping("/major")
public class MajorController {
    @Resource
    private MajorService majorService;
    @PreAuthorize("hasRole('ADMIN')")
    @PostMapping("/insert")
    public Result<Major> insertController(@RequestBody Major major){
        int r=majorService.insert(major);
        if(r==0){
            return Result.success(major);
        }
        else if(r==1){
            return Result.error("1","院系不存在，无法插入！");
        }
        else{
            return Result.error("1","当前记录已存在，插入失败！");
        }
    }
    @PreAuthorize("hasRole('ADMIN')")
    @PostMapping("/update")
    public Result<Major> deleteController(@RequestBody Major major){
        int r=majorService.update(major);
        if(r==0){
            return Result.success(major);
        }
        else if(r==1){
            return Result.error("1","院系不存在，无法更新！");
        }
        else{
            return Result.error("1","当前记录不存在，无法更新！");
        }
    }
    @PreAuthorize("hasRole('ADMIN')")
    @PostMapping("/delete")
    public Result<String> updateController(@RequestParam String majorCode){
        int r=majorService.delete(majorCode);
        if(r==0){
            return Result.success(majorCode);
        }
        else if(r==1){
            return Result.error("1","该专业下班级非空，无法删除！");
        }
        else{
            return Result.error("1","当前记录不存在，删除失败！");
        }
    }

    @PostMapping("/query")
    public Result<Map<Object, Object>> queryController(@RequestBody Major major,String facultyName,@RequestParam int pageIndex, @RequestParam int pageSize){
        Map<Object, Object> response =majorService.query(major,facultyName,pageIndex,pageSize);
        if((int)response.get("total")!=0){
            return Result.success(response,"查询成功");
        }else{
            return Result.error("1","查询结果为空");
        }
    }

}

```

#### 3.2.3 班级管理

##### Class实体

```java
@Table(name = "Class")
@Entity
public class Classes {
    private String className;
    @Id
    private String classCode;
    private String majorCode;

    public Classes() {
    }

    public Classes(String className, String classCode, String majorCode) {
        this.className = className;
        this.classCode = classCode;
        this.majorCode = majorCode;
    }

    public String getClassName() {
        return className;
    }

    public void setClassName(String className) {
        this.className = className;
    }

    public String getClassCode() {
        return classCode;
    }
    public void setClassCode(String classCode) {
        this.classCode = classCode;
    }

    public String getMajorCode() {
        return majorCode;
    }

    public void setMajorCode(String majorCode) {
        this.majorCode = majorCode;
    }
}

```

##### ClassDao

```java
@Repository
public class ClassDao {
    @Autowired
    private JdbcTemplate jdbcTemplate;

    /**
     * 插入
     * @param classes 班级实体
     */
    public void insert(Classes classes) {
        String sql="insert into class values (?,?,?)";
        jdbcTemplate.update(sql,
                classes.getClassName(),
                classes.getClassCode(),
                classes.getMajorCode());
    }

    /**
     * 删除
     * @param classCode 班级代码
     */
    public void delete(String classCode) {
        String sql="delete from class where classCode = ?";
        jdbcTemplate.update(sql, classCode);
    }

    /**
     * 更新
     * @param classes 班级实体
     */
    public void update(Classes classes) {
        String sql="UPDATE class SET className=?, MajorCode=? WHERE classCode=?";
        jdbcTemplate.update(sql,
                classes.getClassName(),
                classes.getMajorCode(),
                classes.getClassCode());
    }

    /**
     * 按某一个属性查询
     * @param attribute 要查询的属性
     * @param name 要查询的属性值
     * @return 查询结果
     */
    public List<Classes> getByAttribute(String attribute, String name) {
        String sql="select * from class where "+attribute+" like ?";
        return jdbcTemplate.query(sql, (rs, rowNum) -> new Classes(
                rs.getString("className"),
                rs.getString("classCode"),
                rs.getString("majorCode")
        ),name);
    }
    /**
     * 按code查询
     */
    public List<Classes> getByCode(String code) {
        String sql="select * from class where classCode = ?";
        return jdbcTemplate.query(sql, (rs, rowNum) -> new Classes(
                rs.getString("className"),
                rs.getString("classCode"),
                rs.getString("majorCode")
        ),code);
    }

    /**
     * 多条件模糊查询
     * @param classes 学生实体
     * @param majorName 要查询的专业名称
     * @param facultyName 要查询的院系名称
     * @param pageIndex 起始页
     * @param pageSize  每页个数
     * @return result
     */
    public Map<Object, Object> query(Classes classes, String majorName, String facultyName, int pageIndex, int pageSize){
        //给出sql模板,为了便于后面添加sql语句
        StringBuilder sql =new StringBuilder("select major.facultyCode,facultyName,class.majorCode,majorName,classCode,className from class,major,faculty where class.majorCode=major.majorCode and major.facultyCode=faculty.facultyCode");
        //给出params
        List<Object> params = new ArrayList<>();
        //构造查询语句
        String className = classes.getClassName();
        if(className != null && !className.trim().isEmpty()){
            sql.append(" and className like ?");
            params.add("%" +className+ "%");
        }

        String classCode = classes.getClassCode();
        if(classCode != null && !classCode.trim().isEmpty()){
            sql.append(" and classCode like ?");
            params.add("%" +classCode+ "%");
        }

        String majorCode= classes.getMajorCode();
        if(majorCode != null && !majorCode.trim().isEmpty()){
            sql.append(" and class.majorCode like ?");
            params.add("%" +majorCode+ "%");
        }

        if(majorName != null && !majorName.trim().isEmpty()){
            sql.append(" and majorName like ?");
            params.add("%" +majorName+ "%");
        }
        if(facultyName != null && !facultyName.trim().isEmpty()){
            sql.append(" and facultyName like ?");
            params.add("%" +facultyName+ "%");
        }

        //统计个数
        String sql2="SELECT count(*) as sum from ("+ sql +") as a;";
        int count=jdbcTemplate.queryForObject(sql2, Integer.class,params.toArray());
        //添加页数条目限制
        sql.append(" limit ?,?");
        params.add((pageIndex-1)*pageSize);
        params.add(pageSize);



        Map<Object, Object> response=new HashMap<>();
        response.put("total",count);
        response.put("pageIndex",pageIndex);
        response.put("tableData",jdbcTemplate.queryForList(sql.toString(), params.toArray()));

        return response;
    }
}

```

##### ClassImpl

接口

```java
@Service
public interface ClassService {
    int insert(Classes classes);

    int delete(String classCode);

    int update(Classes classes);

    Map<Object, Object> query(Classes classes, String majorName, String facultyName,int pageIndex, int pageSize);
}

```

接口实现

```java
@Service
public class ClassServiceImpl implements ClassService {
    @Resource
    private ClassDao classDao;
    @Resource
    private MajorDao majorDao;
    @Resource
    private StudentDao studentDao;
    /**
     * 插入
     * @param classes 班级实体
     * @return 执行结果
     */
    @Override
    public int insert(Classes classes) {
        int num=classDao.getByCode(classes.getClassCode()).size();
        int majorNum=majorDao.getByCode(classes.getMajorCode()).size();
        if(num==0){
            if(majorNum!=0){
                classDao.insert(classes);
                return 0;//成功插入
            }
            else{
                return 1;//专业不存在，无法插入
            }
        }
        else {
            return 2;//当前班级已存在，无法插入
        }
    }
    /**
     * 删除
     * @param classCode 班级代码
     * @return int 0成功,1失败
     */
    @Override
    public int delete(String classCode) {
        int num=classDao.getByCode(classCode).size();
        int studentNum=studentDao.getByAttribute("classCode",classCode).size();
        if(num!=0){
            if(studentNum==0){
                classDao.delete(classCode);
                return 0;
            }
            else {
                return 1;//该班级下学生非空，无法删除
            }
        }
        else {
            return 2;//学生不存在，无法删除
        }
    }
    /**
     * 更新
     * @param classes 班级实体
     * @return int 0成功,1失败
     */
    @Override
    public int update(Classes classes) {
        int num=classDao.getByCode(classes.getClassCode()).size();
        int majorNum=majorDao.getByCode(classes.getMajorCode()).size();
        if(num!=0){
            if(majorNum!=0){
                classDao.update(classes);
                return 0;//成功更新
            }
            else{
                return 1;//专业不存在，无法更新
            }
        }
        else {
            return 2;//当前班级不存在，无法更新
        }
    }

    /**
     * 多条件查询
     * @param classes 班级实体
     * @return result list
     */
    @Override
    public Map<Object, Object> query(Classes classes, String majorName, String facultyName, int pageIndex, int pageSize){
        return classDao.query(classes,majorName,facultyName,pageIndex,pageSize);
    }
}

```

##### ClassController

```java
@RestController
@RequestMapping("/class")
public class ClassController {
    @Resource
    private ClassService classService;

    @PreAuthorize("hasRole('ADMIN')")
    @PostMapping("/insert")
    public Result<Classes> insertController(@RequestBody Classes classes){
        int r=classService.insert(classes);
        if(r==0){
            return Result.success(classes);
        }
        else if(r==1){
            return Result.error("1","对应专业不存在，无法插入！");
        }
        else{
            return Result.error("1","当前记录已存在，插入失败！");
        }
    }
    @PreAuthorize("hasRole('ADMIN')")
    @PostMapping("/update")
    public Result<Classes> deleteController(@RequestBody Classes classes){
        int r=classService.update(classes);
        if(r==0){
            return Result.success(classes);
        }
        else if(r==1){
            return Result.error("1","对应专业不存在，无法更新！");
        }
        else{
            return Result.error("1","当前记录不存在，无法更新！");
        }
    }
    @PreAuthorize("hasRole('ADMIN')")
    @PostMapping("/delete")
    public Result<String> updateController(@RequestParam String classCode){
        int r=classService.delete(classCode);
        if(r==0){
            return Result.success(classCode);
        }
        else if(r==1){
            return Result.error("1","该班级下学生非空，无法删除！");
        }
        else{
            return Result.error("1","当前记录不存在，删除失败！");
        }
    }

    @PostMapping("/query")
    public Result<Map<Object, Object>> queryController(@RequestBody Classes classes, String majorName, String facultyName, @RequestParam int pageIndex, @RequestParam int pageSize){
        Map<Object, Object> response =classService.query(classes,majorName,facultyName,pageIndex,pageSize);
        if((int)response.get("total")!=0){
            return Result.success(response,"查询成功");
        }else{
            return Result.error("1","查询结果为空");
        }
    }

}

```

#### 3.2.4 学生管理

##### Student实体

```java
@Table(name="Student")
@Entity
public class Student {
    private String studentName;
    @Id
    private String studentID;
    private String classCode;
    private String identifier;
    private String dormitory;
    private String address;
    private String teleno;
    private String birthday;
    private String sex;
    private String grade;
    private String completedCredits;

    public Student() {

    }

    public Student(String studentName, String studentID, String classCode, String identifier, String dormitory, String address, String teleno, String birthday, String sex, String grade, String completedCredits) {
        this.studentName = studentName;
        this.studentID = studentID;
        this.classCode = classCode;
        this.identifier = identifier;
        this.dormitory = dormitory;
        this.address = address;
        this.teleno = teleno;
        this.birthday = birthday;
        this.sex = sex;
        this.grade = grade;
        this.completedCredits = completedCredits;
    }

    public String getStudentName() {
        return studentName;
    }

    public String getStudentID() {
        return studentID;
    }

    public String getClassCode() {
        return classCode;
    }

    public String getIdentifier() {
        return identifier;
    }

    public String getDormitory() {
        return dormitory;
    }

    public String getAddress() {
        return address;
    }

    public String getTeleno() {
        return teleno;
    }

    public String getBirthday() {
        return birthday;
    }

    public String getSex() {
        return sex;
    }

    public String getGrade() {
        return grade;
    }

    public String getCompletedCredits() {
        return completedCredits;
    }

    public void setClassCode(String classCode) {
        this.classCode = classCode;
    }

    public void setStudentName(String studentName) {
        this.studentName = studentName;
    }

    public void setStudentID(String studentID) {
        this.studentID = studentID;
    }

    public void setIdentifier(String identifier) {
        this.identifier = identifier;
    }

    public void setDormitory(String dormitory) {
        this.dormitory = dormitory;
    }

    public void setAddress(String address) {
        this.address = address;
    }

    public void setTeleno(String teleno) {
        this.teleno = teleno;
    }

    public void setBirthday(String birthday) {
        this.birthday = birthday;
    }

    public void setSex(String sex) {
        this.sex = sex;
    }

    public void setGrade(String grade) {
        this.grade = grade;
    }

    public void setCompletedCredits(String completedCredits) {
        this.completedCredits = completedCredits;
    }
}

```

##### StudentDao

```java
@Repository
public class StudentDao {
    @Autowired
    private JdbcTemplate jdbcTemplate;

    /**
     * 插入
     * @param student student实体
     * @return student实体
     */
    public Student insert(Student student) {
        String sql="insert into student values (?,?,?,?,?,?,?,?,?,?,?)";
        jdbcTemplate.update(sql,
                student.getStudentName(),
                student.getStudentID(),
                student.getClassCode(),
                student.getIdentifier(),
                student.getDormitory(),
                student.getAddress(),
                student.getTeleno(),
                student.getBirthday(),
                student.getSex(),
                student.getGrade(),
                student.getCompletedCredits());
        return student;
    }

    /**
     * 删除
     */
    public void delete(String studentID) {
        String sql="delete from student where studentID = ?";
        jdbcTemplate.update(sql, studentID);
    }

    /**
     * 更新
     */
    public void update(Student student) {
        String sql="UPDATE student SET " +
                "studentName=?, " +
                "classCode=?, " +
                "identifier=?, " +
                "dormitory=?, " +
                "address=?," +
                "teleno=?," +
                "birthday=?," +
                "sex=?," +
                "grade=?," +
                "completedCredits=?" +
                "WHERE studentId=?";
        jdbcTemplate.update(sql,
                student.getStudentName(),
                student.getClassCode(),
                student.getIdentifier(),
                student.getDormitory(),
                student.getAddress(),
                student.getTeleno(),
                student.getBirthday(),
                student.getSex(),
                student.getGrade(),
                student.getCompletedCredits(),
                student.getStudentID());
    }

    /**
     * 按某一个属性查询
     * @param attribute 要查询的属性
     * @param value 要查询的属性值
     * @return 查询结果
     */
    public List<Student> getByAttribute(String attribute, String value) {
        String sql="select * from student where "+attribute+" like ?";
        return jdbcTemplate.query(sql, (rs, rowNum) -> new Student(
                rs.getString("studentName"),
                rs.getString("studentID"),
                rs.getString("classCode"),
                rs.getString("identifier"),
                rs.getString("dormitory"),
                rs.getString("address"),
                rs.getString("teleno"),
                rs.getString("birthday"),
                rs.getString("sex"),
                rs.getString("grade"),
                rs.getString("completedCredits")
        ),value);
    }
    /**
     * 学生更新可修改的个人信息
     */
    public void updateByStudent(Student student) {
        String sql="UPDATE student SET " +
                "studentName=?, " +
                "identifier=?, " +
                "dormitory=?, " +
                "address=?," +
                "teleno=?," +
                "birthday=?," +
                "sex=?" +
                "WHERE studentId = ?";
        jdbcTemplate.update(sql,
                student.getStudentName(),
                student.getStudentID(),
                student.getDormitory(),
                student.getAddress(),
                student.getTeleno(),
                student.getBirthday(),
                student.getSex(),
                student.getStudentID());
    }
    /**
     * 按Code查询
     */
    public List<Map<String, Object>> getByID(String ID) {
        String sql="select facultyName,faculty.facultyCode,majorName,major.majorCode,className,student.classCode,studentName,studentID,identifier,dormitory,address,teleno,birthday,sex,grade,completedCredits from student,class,major,faculty where student.classCode=class.classCode and class.majorCode=major.majorCode and major.facultyCode=faculty.facultyCode and studentID=?";
        return jdbcTemplate.queryForList(sql,ID);
    }

    /**
     * 多条件模糊查询
     * @param student 学生实体
     * @param className 要查询的班级名称
     * @param majorName 要查询的专业名称
     * @param facultyName 要查询的院系名称
     * @param pageIndex 起始页
     * @param pageSize  每页个数
     * @return 查询结果
     */
    public Map<Object, Object> query(Student student,String className,String majorName,String facultyName,int pageIndex,int pageSize){
        //给出sql模板,为了便于后面添加sql语句
        StringBuilder sql =new StringBuilder("select faculty.facultyCode,facultyName,major.majorCode,\tmajorName,student.classCode,className,studentName,studentID,identifier,dormitory,address,teleno,birthday,sex,grade,completedCredits from student,class,major,faculty where 1=1 and student.classCode=class.classCode and class.majorCode=major.majorCode and major.facultyCode=faculty.facultyCode");
        //给出params
        List<Object> params = new ArrayList<>();
        //构造查询语句
        String studentID = student.getStudentID();
        if(studentID != null && !studentID.trim().isEmpty()){
            sql.append(" and studentID like ?");
            params.add("%" +studentID+ "%");
        }
        String studentName= student.getStudentName();
        if(studentName != null && !studentName.trim().isEmpty()){
            sql.append(" and studentName like ?");
            params.add("%" +studentName+ "%");
        }

        String classCode= student.getClassCode();
        if(classCode != null && !classCode.trim().isEmpty()){
            sql.append(" and student.classCode like ?");
            params.add("%" +classCode+ "%");
        }

        String identifier= student.getIdentifier();
        if(identifier != null && !identifier.trim().isEmpty()){
            sql.append(" and identifier like ?");
            params.add("%" +identifier+ "%");
        }
        String dormitory= student.getDormitory();
        if(dormitory != null && !dormitory.trim().isEmpty()){
            sql.append(" and dormitory like ?");
            params.add("%" +dormitory+ "%");
        }
        String address= student.getAddress();
        if(address != null && !address.trim().isEmpty()){
            sql.append(" and address like ?");
            params.add("%" +address+ "%");
        }
        String teleno= student.getTeleno();
        if(teleno != null && !teleno.trim().isEmpty()){
            sql.append(" and teleno like ?");
            params.add("%" +teleno+ "%");
        }
        String birthday= student.getBirthday();
        if(birthday != null && !birthday.trim().isEmpty()){
            sql.append(" and birthday like ?");
            params.add("%" +birthday+ "%");
        }
        String sex= student.getSex();
        if(sex != null && !sex.trim().isEmpty()){
            sql.append(" and sex like ?");
            params.add("%" +sex+ "%");
        }
        String grade= student.getGrade();
        if(grade != null && !grade.trim().isEmpty()){
            sql.append(" and grade like ?");
            params.add("%" +grade+ "%");
        }
        String completedCredits= student.getCompletedCredits();
        if(completedCredits != null && !completedCredits.trim().isEmpty()){
            sql.append(" and completedCredits like ?");
            params.add("%" +completedCredits+ "%");
        }

        if(className != null && !className.trim().isEmpty()){
            sql.append(" and className like ?");
            params.add("%" +className+ "%");
        }
        if(majorName != null && !majorName.trim().isEmpty()){
            sql.append(" and majorName like ?");
            params.add("%" +majorName+ "%");
        }
        if(facultyName != null && !facultyName.trim().isEmpty()){
            sql.append(" and facultyName like ?");
            params.add("%" +facultyName+ "%");
        }


        //统计个数
        String sql2="SELECT count(*) as sum from ("+ sql +") as a;";
        int count=jdbcTemplate.queryForObject(sql2, Integer.class,params.toArray());
        //添加页数条目限制
        sql.append(" limit ?,?");
        params.add((pageIndex-1)*pageSize);
        params.add(pageSize);



        Map<Object, Object> response=new HashMap<>();
        response.put("total",count);
        response.put("pageIndex",pageIndex);
        response.put("tableData",jdbcTemplate.queryForList(sql.toString(),params.toArray()));

        return response;
    }
}

```

##### StudentImpl

接口

```java
@Service
public interface StudentService {
    int insert(Student student);

    int delete(String studentCode);

    int update(Student student);

    int updateByStudent(Student student);

    List<Map<String, Object>> getInfo();

    Map<Object, Object> query(Student student, String className, String majorName, String facultyName, int pageIndex, int pageSize);
}
```

接口实现

```java
@Service
public class StudentServiceImpl implements StudentService {

    @Resource
    private StudentDao studentDao;
    @Resource
    private ClassDao classDao;

    /**
     * 插入
     * @param student 学生实体
     * @return 执行结果
     */
    @Override
    public int insert(Student student) {
        int num=studentDao.getByID(student.getStudentID()).size();
        System.out.println(student.getStudentID());
        System.out.println(student.getClassCode());
        int classNum=classDao.getByCode(student.getClassCode()).size();
        if(num==0){
            if(classNum!=0){
                studentDao.insert(student);
                return 0;//成功插入
            }
            else{
                return 1;//班级不存在，无法插入
            }
        }
        else {
            return 2;//当前学生已存在，无法插入
        }
    }
    /**
     * 删除
     * @param studentCode 学生代码
     * @return int 0成功,1失败
     */
    @Override
    public int delete(String studentCode) {
        int num=studentDao.getByID(studentCode).size();
        if(num!=0) {
            studentDao.delete(studentCode);
            return 0;
        }
        else {
            return 1;//学生不存在，无法删除
        }
    }
    /**
     * 更新
     * @param student 学生实体
     * @return int 0成功,1失败
     */
    @Override
    public int update(Student student) {
        int num=studentDao.getByID(student.getStudentID()).size();
        int classNum=classDao.getByCode(student.getClassCode()).size();
        if(num!=0){
            if(classNum!=0){
                studentDao.update(student);
                return 0;//成功更新
            }
            else{
                return 1;//班级不存在，无法更新
            }
        }
        else {
            return 2;//当前学生不存在，无法更新
        }
    }

    /**
     * 更新
     * @param student 学生实体
     * @return int 0成功,1失败
     */
    @Override
    public int updateByStudent(Student student) {
        student.setStudentID(SecurityUtil.getUserName());
        int num=studentDao.getByID(student.getStudentID()).size();
        if(num!=0){
                studentDao.updateByStudent(student);
                return 0;//成功更新
        }
        else {
            return 1;//当前学生不存在，无法更新
        }
    }
    /**
     * 按code查询
     * @return result info
     */
    @Override
    public List<Map<String, Object>> getInfo(){
        return studentDao.getByID(SecurityUtil.getUserName());
    }

    /**
     * 多条件查询
     * @param student 学生实体
     * @return result list
     */
    @Override
    public Map<Object, Object> query(Student student, String className, String majorName, String facultyName, int pageIndex, int pageSize){
            return studentDao.query(student,className,majorName,facultyName,pageIndex,pageSize);
    }

}
```

##### StudentController

```java
@RestController
@RequestMapping("/student")
public class StudentController {
    @Resource
    private StudentService studentService;
    @Resource
    private AdminService adminService;

    @PreAuthorize("hasRole('ADMIN')")
    @PostMapping("/insert")
    public Result<Student> insertController(@RequestBody Student student){
        int r=studentService.insert(student);
        if(r==0){
            adminService.studentRegister(student.getStudentID(),"123456");
            return Result.success(student);
        }
        else if(r==1){
            return Result.error("1","班级不存在，无法插入！");
        }
        else{
            return Result.error("1","当前记录已存在，插入失败！");
        }
    }
    @PreAuthorize("hasRole('ADMIN')")
    @PostMapping("/update")
    public Result<Student> updateController(@RequestBody Student student){
        int r=studentService.update(student);
        if(r==0){
            return Result.success(student);
        }
        else if(r==1){
            return Result.error("1","班级不存在，无法更新！");
        }
        else{
            return Result.error("1","当前记录不存在，无法更新！");
        }
    }


    @PreAuthorize("hasRole('ADMIN')")
    @PostMapping("/delete")
    public Result<String> deleteController(@RequestParam String studentID){
        int r=studentService.delete(studentID);
        if(r==0){
            return Result.success(studentID);
        }
        else{
            return Result.error("1","当前记录不存在，删除失败！");
        }
    }
    @PreAuthorize("hasRole('ADMIN')")
    @PostMapping("/query")
    public Result<Map<Object, Object>> queryController(@RequestBody Student student,String className,String majorName,String facultyName,@RequestParam int pageIndex,@RequestParam int pageSize){
        Map<Object, Object> response =studentService.query(student,className,majorName,facultyName,pageIndex,pageSize);
        if((int)response.get("total")!=0){
            return Result.success(response,"查询成功");
        }else{
            return Result.error("1","查询结果为空");
        }
    }

    @PreAuthorize("hasRole('STUDENT')")
    @PostMapping("/info")
    public Result<List<Map<String, Object>>> infoController() {
        List<Map<String, Object>> response = studentService.getInfo();
        return Result.success(response, "查看成功！");
    }

    @PreAuthorize("hasRole('STUDENT')")
    @PostMapping("/updateByStudent")
    public Result<Student> updateByStudentController(@RequestBody Student student){
        int r=studentService.updateByStudent(student);
        if(r==0){
            return Result.success(student);
        }
        else{
            return Result.error("1","当前记录不存在，无法更新！");
        }
    }
}

```

### 3.3 教师管理

#### 3.3.1 教师信息管理

##### Teacher实体

```java
@Table(name = "Teacher")
@Entity
public class Teacher {
    private String teacherName;
    @Id
    private String teacherID;
    private String facultyCode;

    public Teacher() {
    }

    public Teacher(String teacherName, String teacherID, String facultyCode) {
        this.teacherName = teacherName;
        this.teacherID = teacherID;
        this.facultyCode = facultyCode;
    }

    public String getTeacherName() {
        return teacherName;
    }

    public void setTeacherName(String teacherName) {
        this.teacherName = teacherName;
    }

    public String getTeacherID() {
        return teacherID;
    }

    public void setTeacherID(String teacherID) {
        this.teacherID = teacherID;
    }

    public String getFacultyCode() {
        return facultyCode;
    }

    public void setFacultyCode(String facultyCode) {
        this.facultyCode = facultyCode;
    }
}
```

##### TeacherDao

```java
@Repository
public class TeacherDao {
    @Autowired
    private JdbcTemplate jdbcTemplate;

    /**
     * 插入
     *
     * @param teacher 教师实体
     */
    public void insert(Teacher teacher) {
        String sql = "insert into Teacher values (?,?,?)";
        jdbcTemplate.update(sql,
                teacher.getTeacherName(),
                teacher.getTeacherID(),
                teacher.getFacultyCode());
    }

    /**
     * 删除
     *
     * @param teacherID 教师编号
     */
    public void delete(String teacherID) {
        String sql = "delete from Teacher where teacherID = ?";
        jdbcTemplate.update(sql, teacherID);
    }

    /**
     * 更新
     *
     * @param teacher 教师实体
     */
    public void update(Teacher teacher) {
        String sql = "UPDATE Teacher SET teacherName=?,facultyCode=? WHERE teacherID=?";
        jdbcTemplate.update(sql,
                teacher.getTeacherName(),
                teacher.getFacultyCode(),
                teacher.getTeacherID());
    }

    /**
     * 多条件模糊查询
     *
     * @param map 查询条件
     * @param pageIndex 起始页
     * @param pageSize  每页个数
     * @return result
     */
    public Map<Object, Object> query(Map<String,Object> map, int pageIndex, int pageSize) {
        //给出sql模板,为了便于后面添加sql语句
        StringBuilder sql = new StringBuilder("select teacherID,teacherName,teacher.facultyCode,facultyName from teacher,faculty where 1=1 and teacher.facultyCode=faculty.facultyCode");
        //给出params
        List<Object> params = new ArrayList<>();
        //构造查询语句
        if (map.get("teacherName")!=null)
        {
            String s = map.get("teacherName").toString();
            if (s != null && !s.trim().isEmpty())
            {
                sql.append(" and teacherName like ?");
                params.add("%" + s + "%");
            }
        }
        if (map.get("teacherID")!=null)
        {
            String s = map.get("teacherID").toString();
            if (s != null && !s.trim().isEmpty()) {
                sql.append(" and teacherID like ?");
                params.add("%" + s + "%");
            }
        }
        if (map.get("facultyCode")!=null)
        {
            String s = map.get("facultyCode").toString();
            if (s != null && !s.trim().isEmpty()) {
                sql.append(" and teacher.facultyCode like ?");
                params.add("%" + s + "%");
            }
        }
        if (map.get("facultyName")!=null)
        {
            String s = map.get("facultyName").toString();
            if (s != null && !s.trim().isEmpty()) {
                sql.append(" and facultyName like ?");
                params.add("%" + s + "%");
            }
        }
        //统计个数
        String sql2 = "SELECT count(*) as sum from (" + sql + ") as a;";
        int count = jdbcTemplate.queryForObject(sql2, Integer.class, params.toArray());
        //添加页数条目限制
        sql.append(" limit ?,?");
        params.add((pageIndex - 1) * pageSize);
        params.add(pageSize);

        Map<Object, Object> response = new HashMap<>();
        response.put("total", count);
        response.put("pageIndex", pageIndex);
        response.put("tableData", jdbcTemplate.queryForList(sql.toString(), params.toArray()));
        return response;
    }
    /**
     * 多条件模糊查询，结果中无教师ID
     *
     * @param map 查询条件
     * @param pageIndex 起始页
     * @param pageSize  每页个数
     * @return result
     */
    public Map<Object, Object> queryWithoutID(Map<String,Object> map, int pageIndex, int pageSize) {
        //给出sql模板,为了便于后面添加sql语句
        StringBuilder sql = new StringBuilder("select teacherName,teacher.facultyCode,facultyName from teacher,faculty where 1=1 and teacher.facultyCode=faculty.facultyCode");
        //给出params
        List<Object> params = new ArrayList<>();
        //构造查询语句
        if (map.get("teacherName")!=null)
        {
            String s = map.get("teacherName").toString();
            if (s != null && !s.trim().isEmpty())
            {
                sql.append(" and teacherName like ?");
                params.add("%" + s + "%");
            }
        }
        if (map.get("facultyCode")!=null)
        {
            String s = map.get("facultyCode").toString();
            if (s != null && !s.trim().isEmpty()) {
                sql.append(" and teacher.facultyCode like ?");
                params.add("%" + s + "%");
            }
        }
        if (map.get("facultyName")!=null)
        {
            String s = map.get("facultyName").toString();
            if (s != null && !s.trim().isEmpty()) {
                sql.append(" and facultyName like ?");
                params.add("%" + s + "%");
            }
        }
        //统计个数
        String sql2 = "SELECT count(*) as sum from (" + sql + ") as a;";
        int count = jdbcTemplate.queryForObject(sql2, Integer.class, params.toArray());
        //添加页数条目限制
        sql.append(" limit ?,?");
        params.add((pageIndex - 1) * pageSize);
        params.add(pageSize);

        Map<Object, Object> response = new HashMap<>();
        response.put("total", count);
        response.put("pageIndex", pageIndex);
        response.put("tableData", jdbcTemplate.queryForList(sql.toString(), params.toArray()));
        return response;
    }
    /**
     * 按teacher字段查询
     *
     * @param attribute 字段名
     * @param name      字段的值
     * @return 返回查询结果
     */
    public List<Teacher> getByAttribute(String attribute, String name) {
        String sql = "select * from teacher where " + attribute + "=?";

        return jdbcTemplate.query(sql, (rs, rowNum) -> new Teacher(
                        rs.getString("teacherName"),
                        rs.getString("teacherID"),
                        rs.getString("facultyCode"))
                , name);
    }

    /**
     * 列表查看
     */
    public List<Teacher> getList() {
        String sql = "select * from teacher";
        return jdbcTemplate.query(sql, (rs, rowNum) -> new Teacher(
                rs.getString("teacherName"),
                rs.getString("teacherID"),
                rs.getString("facultyCode")
        ));
    }

    /**
     * 按ID查询
     */
    public List<Teacher> getByID(String ID) {
        String sql="select * from teacher where teacherID=?";
        return jdbcTemplate.query(sql, (rs, rowNum) -> new Teacher(
                rs.getString("teacherName"),
                rs.getString("teacherID"),
                rs.getString("facultyCode"))
        ,ID);
    }
}
```

##### TeacherImpl

接口

```java
public interface TeacherService {
    int insert(Teacher teacher);

    int delete(String teacherID);

    int update(Teacher teacher);

    Map<Object, Object> query(Map<String, Object> map, int pageIndex, int pageSize);

    Map<Object, Object> queryWithoutID(Map<String, Object> map, int pageIndex, int pageSize);

    List<Teacher> getList();

    List<Teacher> info();
}
```

接口实现

```java
@Service
public class TeacherServiceImpl implements TeacherService {
    @Resource
    private TeacherDao teacherDao;
    @Resource
    private FacultyDao facultyDao;
    @Resource
    private CourseClassDao courseClassDao;

    /**
     * 插入
     *
     * @param teacher 教师实体
     * @return 0:成功, 1:失败，院系不存在, 2:失败，该教师已存在
     */
    @Override
    public int insert(Teacher teacher) {
        int num = teacherDao.getByAttribute("teacherID", teacher.getTeacherID()).size();
        if ((facultyDao.getByCode(teacher.getFacultyCode()).size() == 0)) {
            return 1;
        } else if (num == 0) {
            teacherDao.insert(teacher);
            return 0;
        } else {
            return 2;
        }
    }

    /**
     * 按ID删除
     *
     * @param teacherID 教师编号
     * @return 0:成功, 1:失败，对应课程班级非空, 2:失败，该教师不存在
     */
    @Override
    public int delete(String teacherID) {
        int num = teacherDao.getByAttribute("teacherID", teacherID).size();
        if (courseClassDao.getByAttribute("teacherID", teacherID).size() != 0) {
            return 1;
        } else if (num != 0) {
            teacherDao.delete(teacherID);
            return 0;
        } else {
            return 2;
        }
    }

    /**
     * 更新
     *
     * @param teacher 教师实体
     * @return 0:成功, 1:失败，院系不存在, 2:失败，该教师不存在
     */
    @Override
    public int update(Teacher teacher) {
        int num = teacherDao.getByAttribute("teacherID", teacher.getTeacherID()).size();
        if ((facultyDao.getByCode(teacher.getFacultyCode()).size() == 0)) {
            return 1;
        } else if (num != 0) {
            teacherDao.update(teacher);
            return 0;
        } else {
            return 2;
        }
    }

    /**
     * 多条件查询
     *
     * @param map：查询条件
     * @return result list
     */
    @Override
    public Map<Object, Object> query(Map<String, Object> map, int pageIndex, int pageSize) {
        return teacherDao.query(map, pageIndex, pageSize);
    }

    /**
     * 多条件查询，得不到ID
     *
     * @param map：查询条件
     * @return result list
     */
    @Override
    public Map<Object, Object> queryWithoutID(Map<String, Object> map, int pageIndex, int pageSize) {
        return teacherDao.queryWithoutID(map, pageIndex, pageSize);
    }

    /**
     * 全部查询
     *
     * @return result list
     */
    @Override
    public List<Teacher> getList() {
        return teacherDao.getList();
    }

    /**
     * 得到自己的信息
     *
     * @return result list
     */
    @Override
    public List<Teacher> info() {
        Map<String, Object> map = new HashMap<>();
        map.put("teacherName", null);
        map.put("teacherID", SecurityUtil.getUserName());
        map.put("facultyCode", null);
        map.put("facultyName", null);
        return (List<Teacher>) teacherDao.query(map, 1, 1).get("tableData");
    }
}
```

##### TeacherController

```java
@RestController
@RequestMapping("/teacher")
public class TeacherController {
    @Resource
    private TeacherService teacherService;
    @Resource
    private AdminService adminService;

    @PreAuthorize("hasRole('ADMIN')")
    @PostMapping("/insert")
    public Result<Teacher> insertController(@RequestBody Teacher teacher) {
        int result = teacherService.insert(teacher);
        if (result == 0) {
            adminService.teacherRegister(teacher.getTeacherID(),"123456");
            return Result.success(teacher);
        } else if (result == 1) {
            return Result.error("1", "对应院系不存在，插入失败！");
        } else {
            return Result.error("2", "当前记录已存在，插入失败！");
        }
    }

    @PreAuthorize("hasRole('ADMIN')")
    @PostMapping("/update")
    public Result<Teacher> updateController(@RequestBody Teacher teacher) {
        int result = teacherService.update(teacher);
        if (result == 0) {
            return Result.success(teacher);
        } else if (result == 1) {
            return Result.error("1", "对应院系不存在，更新失败！");
        } else {
            return Result.error("2", "当前记录不存在，更新失败！");
        }
    }

    @PreAuthorize("hasRole('ADMIN')")
    @PostMapping("/delete")
    public Result<String> deleteController(@RequestParam String teacherID) {
        int result = teacherService.delete(teacherID);
        if (result == 0) {
            return Result.success(teacherID);
        } else if (result == 1) {
            return Result.error("1", "对应课程班级非空，删除失败！");
        } else {
            return Result.error("2", "当前教师不存在，删除失败！");
        }
    }

    @PreAuthorize("hasRole('ADMIN')")
    @GetMapping("/list")
    public Result<List<Teacher>> listController() {
        List<Teacher> list = teacherService.getList();
        if (!list.isEmpty()) {
            return Result.success(list, "列表查看成功！");
        } else {
            return Result.error("1", "当前列表为空！");
        }
    }

    @PreAuthorize("hasRole('ADMIN')")
    @PostMapping("/query")
    public Result<Map<Object, Object>> queryController(@RequestBody Map<String,Object> map, @RequestParam int pageIndex, @RequestParam int pageSize) {
        Map<Object, Object> response = teacherService.query(map, pageIndex, pageSize);
        if ((int) response.get("total") != 0) {
            return Result.success(response, "查询成功");
        } else {
            return Result.error("1", "查询结果为空");
        }
    }
    @PreAuthorize("hasAnyRole('STUDENT','TEACHER')")
    @PostMapping("/queryWithoutID")
    public Result<Map<Object, Object>> queryWithoutIDController(@RequestBody Map<String,Object> map, @RequestParam int pageIndex, @RequestParam int pageSize) {
        Map<Object, Object> response = teacherService.queryWithoutID(map, pageIndex, pageSize);
        if ((int) response.get("total") != 0) {
            return Result.success(response, "查询成功");
        } else {
            return Result.error("1", "查询结果为空");
        }
    }
    @PreAuthorize("hasRole('TEACHER')")
    @PostMapping("/info")
    public Result<List<Teacher>> infoController() {
        List<Teacher> list = teacherService.info();
        return Result.success(list, "查看成功！");
    }
}

```

#### 3.3.2 教师授课管理

##### CourseClass实体

```java
@Repository
public class CourseClassDao {
    @Autowired
    private JdbcTemplate jdbcTemplate;

    /**
     * 插入
     *
     * @param courseClass 课程班级实体
     */
    public void insert(CourseClass courseClass) {
        String sql = "insert into CourseClass values (?,?,?,?,?,?)";
        jdbcTemplate.update(sql, courseClass.getCourseClassID(), courseClass.getCourseID(), courseClass.getTeacherID(), courseClass.getCourseClassTime(), courseClass.getCourseClassAddress(), courseClass.getCourseClassWeek());
    }

    /**
     * 删除
     *
     * @param courseClassID 开课号
     */
    public void delete(String courseClassID) {
        String sql = "delete from CourseClass where courseClassID = ?";
        jdbcTemplate.update(sql, courseClassID);
    }

    /**
     * 更新
     *
     * @param courseClass 课程班级实体
     */
    public void update(CourseClass courseClass) {
        String sql = "UPDATE CourseClass SET courseID=?,teacherID=?,courseClassTime=?,courseClassAddress=?,courseClassWeek=? WHERE courseClassID=?";
        jdbcTemplate.update(sql, courseClass.getCourseID(), courseClass.getTeacherID(), courseClass.getCourseClassTime(), courseClass.getCourseClassAddress(), courseClass.getCourseClassWeek(), courseClass.getCourseClassID());
    }

    public Map<Object, Object> query(Map<String, Object> map, int pageIndex, int pageSize) {
        //给出sql模板,为了便于后面添加sql语句
        StringBuilder sql = new StringBuilder("select courseClassID,courseclass.courseID,courseName,courseclass.teacherID,teacherName,facultyName,courseClassTime,courseClassAddress,courseClassWeek,courseNature,courseCategory,courseHours,credit from courseClass,teacher,course,faculty  where 1=1 and courseclass.teacherID=teacher.teacherID and courseclass.courseID=course.courseID and course.facultyCode=faculty.facultyCode");
        //给出params
        List<Object> params = new ArrayList<>();
        //构造查询语句
        if (map.get("courseClassID") != null) {
            String s = map.get("courseClassID").toString();
            if (s != null && !s.trim().isEmpty()) {
                sql.append(" and courseClassID like ?");
                params.add("%" + s + "%");
            }
        }
        if (map.get("courseID") != null) {
            String s = map.get("courseID").toString();
            if (s != null && !s.trim().isEmpty()) {
                sql.append(" and courseclass.courseID like ?");
                params.add("%" + s + "%");
            }
        }
        if (map.get("courseName") != null) {
            String s = map.get("courseName").toString();
            if (s != null && !s.trim().isEmpty()) {
                sql.append(" and courseName like ?");
                params.add("%" + s + "%");
            }
        }
        if (map.get("teacherID") != null) {
            String s = map.get("teacherID").toString();
            if (s != null && !s.trim().isEmpty()) {
                sql.append(" and courseclass.teacherID like ?");
                params.add("%" + s + "%");
            }
        }
        if (map.get("teacherName") != null) {
            String s = map.get("teacherName").toString();
            if (s != null && !s.trim().isEmpty()) {
                sql.append(" and teacherName like ?");
                params.add("%" + s + "%");
            }
        }
        if (map.get("facultyName") != null) {
            String s = map.get("facultyName").toString();
            if (s != null && !s.trim().isEmpty()) {
                sql.append(" and facultyName like ?");
                params.add("%" + s + "%");
            }
        }
        if (map.get("courseClassTime") != null) {
            String s = map.get("courseClassTime").toString();
            if (s != null && !s.trim().isEmpty()) {
                sql.append(" and courseClassTime like ?");
                params.add("%" + s + "%");
            }
        }
        if (map.get("courseClassAddress") != null) {
            String s = map.get("courseClassAddress").toString();
            if (s != null && !s.trim().isEmpty()) {
                sql.append(" and courseClassAddress like ?");
                params.add("%" + s + "%");
            }
        }
        if (map.get("courseClassWeek") != null) {
            String s = map.get("courseClassWeek").toString();
            if (s != null && !s.trim().isEmpty()) {
                sql.append(" and courseClassWeek like ?");
                params.add("%" + s + "%");
            }
        }
        if (map.get("courseNature") != null) {
            String s = map.get("courseNature").toString();
            if (s != null && !s.trim().isEmpty()) {
                sql.append(" and courseNature like ?");
                params.add("%" + s + "%");
            }
        }
        if (map.get("courseCategory") != null) {
            String s = map.get("courseCategory").toString();
            if (s != null && !s.trim().isEmpty()) {
                sql.append(" and courseCategory like ?");
                params.add("%" + s + "%");
            }
        }
        if (map.get("courseHours") != null) {
            Integer s = (Integer) map.get("credit");
            if (s != null) {
                sql.append(" and courseHours like ?");
                params.add("%" + s + "%");
            }
        }
        if (map.get("credit") != null) {
            Integer s = (Integer) map.get("credit");
            if (s != null) {
                sql.append(" and credit like ?");
                params.add("%" + s + "%");
            }
        }
        //统计个数
        String sql2 = "SELECT count(*) as sum from (" + sql + ") as a;";
        System.out.println(sql);
        int count = jdbcTemplate.queryForObject(sql2, Integer.class, params.toArray());

        //添加页数条目限制
        sql.append(" limit ?,?");
        params.add((pageIndex - 1) * pageSize);
        params.add(pageSize);


        Map<Object, Object> response = new HashMap<>();
        response.put("total", count);
        response.put("pageIndex", pageIndex);
        response.put("tableData", jdbcTemplate.queryForList(sql.toString(), params.toArray()));

        return response;
    }

    public Map<Object, Object> queryByUser(Map<String, Object> map, int pageIndex, int pageSize) {
        //给出sql模板,为了便于后面添加sql语句
        StringBuilder sql = new StringBuilder("select courseClassID,courseclass.courseID,courseName,teacherName,facultyName,courseClassTime,courseClassAddress,courseClassWeek,courseNature,courseCategory,courseHours,credit from courseClass,teacher,course,faculty  where 1=1 and courseclass.teacherID=teacher.teacherID and courseclass.courseID=course.courseID and course.facultyCode=faculty.facultyCode");
        //给出params
        List<Object> params = new ArrayList<>();
        //构造查询语句
        if (map.get("courseClassID") != null) {
            String s = map.get("courseClassID").toString();
            if (s != null && !s.trim().isEmpty()) {
                sql.append(" and courseClassID like ?");
                params.add("%" + s + "%");
            }
        }
        if (map.get("courseID") != null) {
            String s = map.get("courseID").toString();
            if (s != null && !s.trim().isEmpty()) {
                sql.append(" and courseclass.courseID like ?");
                params.add("%" + s + "%");
            }
        }
        if (map.get("courseName") != null) {
            String s = map.get("courseName").toString();
            if (s != null && !s.trim().isEmpty()) {
                sql.append(" and courseName like ?");
                params.add("%" + s + "%");
            }
        }
        if (map.get("teacherName") != null) {
            String s = map.get("teacherName").toString();
            if (s != null && !s.trim().isEmpty()) {
                sql.append(" and teacherName like ?");
                params.add("%" + s + "%");
            }
        }
        if (map.get("facultyName") != null) {
            String s = map.get("facultyName").toString();
            if (s != null && !s.trim().isEmpty()) {
                sql.append(" and facultyName like ?");
                params.add("%" + s + "%");
            }
        }
        if (map.get("courseClassTime") != null) {
            String s = map.get("courseClassTime").toString();
            if (s != null && !s.trim().isEmpty()) {
                sql.append(" and courseClassTime like ?");
                params.add("%" + s + "%");
            }
        }
        if (map.get("courseClassAddress") != null) {
            String s = map.get("courseClassAddress").toString();
            if (s != null && !s.trim().isEmpty()) {
                sql.append(" and courseClassAddress like ?");
                params.add("%" + s + "%");
            }
        }
        if (map.get("courseClassWeek") != null) {
            String s = map.get("courseClassWeek").toString();
            if (s != null && !s.trim().isEmpty()) {
                sql.append(" and courseClassWeek like ?");
                params.add("%" + s + "%");
            }
        }
        if (map.get("courseNature") != null) {
            String s = map.get("courseNature").toString();
            if (s != null && !s.trim().isEmpty()) {
                sql.append(" and courseNature like ?");
                params.add("%" + s + "%");
            }
        }
        if (map.get("courseCategory") != null) {
            String s = map.get("courseCategory").toString();
            if (s != null && !s.trim().isEmpty()) {
                sql.append(" and courseCategory like ?");
                params.add("%" + s + "%");
            }
        }
        if (map.get("courseHours") != null) {
            Integer s = (Integer) map.get("credit");
            if (s != null) {
                sql.append(" and courseHours like ?");
                params.add("%" + s + "%");
            }
        }
        if (map.get("credit") != null) {
            Integer s = (Integer) map.get("credit");
            if (s != null) {
                sql.append(" and credit like ?");
                params.add("%" + s + "%");
            }
        }
        //统计个数
        String sql2 = "SELECT count(*) as sum from (" + sql + ") as a;";
        System.out.println(sql);
        int count = jdbcTemplate.queryForObject(sql2, Integer.class, params.toArray());

        //添加页数条目限制
        sql.append(" limit ?,?");
        params.add((pageIndex - 1) * pageSize);
        params.add(pageSize);


        Map<Object, Object> response = new HashMap<>();
        response.put("total", count);
        response.put("pageIndex", pageIndex);
        response.put("tableData", jdbcTemplate.queryForList(sql.toString(), params.toArray()));

        return response;
    }

    /**
     * 按courseClassID字段查询
     *
     * @param code courseClassID字段的值
     * @return 返回查询结果
     */
    public List<CourseClass> getByCode(String code) {
        String sql = "select * from courseclass where courseClassID=?";
        return jdbcTemplate.query(sql, (rs, rowNum) -> new CourseClass(rs.getString("courseClassID"), rs.getString("courseID"), rs.getString("teacherID"), rs.getString("courseClassTime"), rs.getString("courseClassAddress"), rs.getString("courseClassWeek")), code);
    }

    /**
     * 按courseClass字段查询
     *
     * @param attribute 字段名
     * @param name      字段的值
     * @return 返回查询结果
     */
    public List<CourseClass> getByAttribute(String attribute, String name) {
        String sql = "select * from courseClass where " + attribute + "=?";
        return jdbcTemplate.query(sql, (rs, rowNum) -> new CourseClass(rs.getString("courseClassID"), rs.getString("courseID"), rs.getString("teacherID"), rs.getString("courseClassTime"), rs.getString("courseClassAddress"), rs.getString("courseClassWeek")), name);
    }

    /**
     * 列表查看（全部查询）
     */
    public List<CourseClass> getList() {
        String sql = "select * from CourseClass";
        return jdbcTemplate.query(sql, (rs, rowNum) -> new CourseClass(rs.getString("courseClassID"), rs.getString("courseID"), rs.getString("teacherID"), rs.getString("courseClassTime"), rs.getString("courseClassAddress"), rs.getString("courseClassWeek")));
    }
}
```

##### CourseClassDao

```java
@Repository
public class CourseClassDao {
    @Autowired
    private JdbcTemplate jdbcTemplate;

    /**
     * 插入
     *
     * @param courseClass 课程班级实体
     */
    public void insert(CourseClass courseClass) {
        String sql = "insert into CourseClass values (?,?,?,?,?,?)";
        jdbcTemplate.update(sql, courseClass.getCourseClassID(), courseClass.getCourseID(), courseClass.getTeacherID(), courseClass.getCourseClassTime(), courseClass.getCourseClassAddress(), courseClass.getCourseClassWeek());
    }

    /**
     * 删除
     *
     * @param courseClassID 开课号
     */
    public void delete(String courseClassID) {
        String sql = "delete from CourseClass where courseClassID = ?";
        jdbcTemplate.update(sql, courseClassID);
    }

    /**
     * 更新
     *
     * @param courseClass 课程班级实体
     */
    public void update(CourseClass courseClass) {
        String sql = "UPDATE CourseClass SET courseID=?,teacherID=?,courseClassTime=?,courseClassAddress=?,courseClassWeek=? WHERE courseClassID=?";
        jdbcTemplate.update(sql, courseClass.getCourseID(), courseClass.getTeacherID(), courseClass.getCourseClassTime(), courseClass.getCourseClassAddress(), courseClass.getCourseClassWeek(), courseClass.getCourseClassID());
    }

    public Map<Object, Object> query(Map<String, Object> map, int pageIndex, int pageSize) {
        //给出sql模板,为了便于后面添加sql语句
        StringBuilder sql = new StringBuilder("select courseClassID,courseclass.courseID,courseName,courseclass.teacherID,teacherName,facultyName,courseClassTime,courseClassAddress,courseClassWeek,courseNature,courseCategory,courseHours,credit from courseClass,teacher,course,faculty  where 1=1 and courseclass.teacherID=teacher.teacherID and courseclass.courseID=course.courseID and course.facultyCode=faculty.facultyCode");
        //给出params
        List<Object> params = new ArrayList<>();
        //构造查询语句
        if (map.get("courseClassID") != null) {
            String s = map.get("courseClassID").toString();
            if (s != null && !s.trim().isEmpty()) {
                sql.append(" and courseClassID like ?");
                params.add("%" + s + "%");
            }
        }
        if (map.get("courseID") != null) {
            String s = map.get("courseID").toString();
            if (s != null && !s.trim().isEmpty()) {
                sql.append(" and courseclass.courseID like ?");
                params.add("%" + s + "%");
            }
        }
        if (map.get("courseName") != null) {
            String s = map.get("courseName").toString();
            if (s != null && !s.trim().isEmpty()) {
                sql.append(" and courseName like ?");
                params.add("%" + s + "%");
            }
        }
        if (map.get("teacherID") != null) {
            String s = map.get("teacherID").toString();
            if (s != null && !s.trim().isEmpty()) {
                sql.append(" and courseclass.teacherID like ?");
                params.add("%" + s + "%");
            }
        }
        if (map.get("teacherName") != null) {
            String s = map.get("teacherName").toString();
            if (s != null && !s.trim().isEmpty()) {
                sql.append(" and teacherName like ?");
                params.add("%" + s + "%");
            }
        }
        if (map.get("facultyName") != null) {
            String s = map.get("facultyName").toString();
            if (s != null && !s.trim().isEmpty()) {
                sql.append(" and facultyName like ?");
                params.add("%" + s + "%");
            }
        }
        if (map.get("courseClassTime") != null) {
            String s = map.get("courseClassTime").toString();
            if (s != null && !s.trim().isEmpty()) {
                sql.append(" and courseClassTime like ?");
                params.add("%" + s + "%");
            }
        }
        if (map.get("courseClassAddress") != null) {
            String s = map.get("courseClassAddress").toString();
            if (s != null && !s.trim().isEmpty()) {
                sql.append(" and courseClassAddress like ?");
                params.add("%" + s + "%");
            }
        }
        if (map.get("courseClassWeek") != null) {
            String s = map.get("courseClassWeek").toString();
            if (s != null && !s.trim().isEmpty()) {
                sql.append(" and courseClassWeek like ?");
                params.add("%" + s + "%");
            }
        }
        if (map.get("courseNature") != null) {
            String s = map.get("courseNature").toString();
            if (s != null && !s.trim().isEmpty()) {
                sql.append(" and courseNature like ?");
                params.add("%" + s + "%");
            }
        }
        if (map.get("courseCategory") != null) {
            String s = map.get("courseCategory").toString();
            if (s != null && !s.trim().isEmpty()) {
                sql.append(" and courseCategory like ?");
                params.add("%" + s + "%");
            }
        }
        if (map.get("courseHours") != null) {
            Integer s = (Integer) map.get("credit");
            if (s != null) {
                sql.append(" and courseHours like ?");
                params.add("%" + s + "%");
            }
        }
        if (map.get("credit") != null) {
            Integer s = (Integer) map.get("credit");
            if (s != null) {
                sql.append(" and credit like ?");
                params.add("%" + s + "%");
            }
        }
        //统计个数
        String sql2 = "SELECT count(*) as sum from (" + sql + ") as a;";
        System.out.println(sql);
        int count = jdbcTemplate.queryForObject(sql2, Integer.class, params.toArray());

        //添加页数条目限制
        sql.append(" limit ?,?");
        params.add((pageIndex - 1) * pageSize);
        params.add(pageSize);


        Map<Object, Object> response = new HashMap<>();
        response.put("total", count);
        response.put("pageIndex", pageIndex);
        response.put("tableData", jdbcTemplate.queryForList(sql.toString(), params.toArray()));

        return response;
    }

    public Map<Object, Object> queryByUser(Map<String, Object> map, int pageIndex, int pageSize) {
        //给出sql模板,为了便于后面添加sql语句
        StringBuilder sql = new StringBuilder("select courseClassID,courseclass.courseID,courseName,teacherName,facultyName,courseClassTime,courseClassAddress,courseClassWeek,courseNature,courseCategory,courseHours,credit from courseClass,teacher,course,faculty  where 1=1 and courseclass.teacherID=teacher.teacherID and courseclass.courseID=course.courseID and course.facultyCode=faculty.facultyCode");
        //给出params
        List<Object> params = new ArrayList<>();
        //构造查询语句
        if (map.get("courseClassID") != null) {
            String s = map.get("courseClassID").toString();
            if (s != null && !s.trim().isEmpty()) {
                sql.append(" and courseClassID like ?");
                params.add("%" + s + "%");
            }
        }
        if (map.get("courseID") != null) {
            String s = map.get("courseID").toString();
            if (s != null && !s.trim().isEmpty()) {
                sql.append(" and courseclass.courseID like ?");
                params.add("%" + s + "%");
            }
        }
        if (map.get("courseName") != null) {
            String s = map.get("courseName").toString();
            if (s != null && !s.trim().isEmpty()) {
                sql.append(" and courseName like ?");
                params.add("%" + s + "%");
            }
        }
        if (map.get("teacherName") != null) {
            String s = map.get("teacherName").toString();
            if (s != null && !s.trim().isEmpty()) {
                sql.append(" and teacherName like ?");
                params.add("%" + s + "%");
            }
        }
        if (map.get("facultyName") != null) {
            String s = map.get("facultyName").toString();
            if (s != null && !s.trim().isEmpty()) {
                sql.append(" and facultyName like ?");
                params.add("%" + s + "%");
            }
        }
        if (map.get("courseClassTime") != null) {
            String s = map.get("courseClassTime").toString();
            if (s != null && !s.trim().isEmpty()) {
                sql.append(" and courseClassTime like ?");
                params.add("%" + s + "%");
            }
        }
        if (map.get("courseClassAddress") != null) {
            String s = map.get("courseClassAddress").toString();
            if (s != null && !s.trim().isEmpty()) {
                sql.append(" and courseClassAddress like ?");
                params.add("%" + s + "%");
            }
        }
        if (map.get("courseClassWeek") != null) {
            String s = map.get("courseClassWeek").toString();
            if (s != null && !s.trim().isEmpty()) {
                sql.append(" and courseClassWeek like ?");
                params.add("%" + s + "%");
            }
        }
        if (map.get("courseNature") != null) {
            String s = map.get("courseNature").toString();
            if (s != null && !s.trim().isEmpty()) {
                sql.append(" and courseNature like ?");
                params.add("%" + s + "%");
            }
        }
        if (map.get("courseCategory") != null) {
            String s = map.get("courseCategory").toString();
            if (s != null && !s.trim().isEmpty()) {
                sql.append(" and courseCategory like ?");
                params.add("%" + s + "%");
            }
        }
        if (map.get("courseHours") != null) {
            Integer s = (Integer) map.get("credit");
            if (s != null) {
                sql.append(" and courseHours like ?");
                params.add("%" + s + "%");
            }
        }
        if (map.get("credit") != null) {
            Integer s = (Integer) map.get("credit");
            if (s != null) {
                sql.append(" and credit like ?");
                params.add("%" + s + "%");
            }
        }
        //统计个数
        String sql2 = "SELECT count(*) as sum from (" + sql + ") as a;";
        System.out.println(sql);
        int count = jdbcTemplate.queryForObject(sql2, Integer.class, params.toArray());

        //添加页数条目限制
        sql.append(" limit ?,?");
        params.add((pageIndex - 1) * pageSize);
        params.add(pageSize);


        Map<Object, Object> response = new HashMap<>();
        response.put("total", count);
        response.put("pageIndex", pageIndex);
        response.put("tableData", jdbcTemplate.queryForList(sql.toString(), params.toArray()));

        return response;
    }

    /**
     * 按courseClassID字段查询
     *
     * @param code courseClassID字段的值
     * @return 返回查询结果
     */
    public List<CourseClass> getByCode(String code) {
        String sql = "select * from courseclass where courseClassID=?";
        return jdbcTemplate.query(sql, (rs, rowNum) -> new CourseClass(rs.getString("courseClassID"), rs.getString("courseID"), rs.getString("teacherID"), rs.getString("courseClassTime"), rs.getString("courseClassAddress"), rs.getString("courseClassWeek")), code);
    }

    /**
     * 按courseClass字段查询
     *
     * @param attribute 字段名
     * @param name      字段的值
     * @return 返回查询结果
     */
    public List<CourseClass> getByAttribute(String attribute, String name) {
        String sql = "select * from courseClass where " + attribute + "=?";
        return jdbcTemplate.query(sql, (rs, rowNum) -> new CourseClass(rs.getString("courseClassID"), rs.getString("courseID"), rs.getString("teacherID"), rs.getString("courseClassTime"), rs.getString("courseClassAddress"), rs.getString("courseClassWeek")), name);
    }

    /**
     * 列表查看（全部查询）
     */
    public List<CourseClass> getList() {
        String sql = "select * from CourseClass";
        return jdbcTemplate.query(sql, (rs, rowNum) -> new CourseClass(rs.getString("courseClassID"), rs.getString("courseID"), rs.getString("teacherID"), rs.getString("courseClassTime"), rs.getString("courseClassAddress"), rs.getString("courseClassWeek")));
    }
}
```

##### CourseClassImpl

接口

```java
public interface CourseClassService {
    int insert(CourseClass courseClass);

    int delete(String courseClassID);

    int update(CourseClass courseClass);

    List<CourseClass> getList();
    Map<Object, Object> query(Map<String,Object> map, int pageIndex, int pageSize);
    Map<Object, Object> queryByUser(Map<String,Object> map, int pageIndex, int pageSize);

    int insertByTeacher(CourseClass courseClass);

    int updateByTeacher(CourseClass courseClass);

    int deleteByTeacher(String courseClassID);
}
```

接口实现

```java
@Service
public class CourseServiceImpl implements CourseService {
    @Resource
    private CourseDao courseDao;
    @Resource
    private FacultyDao facultyDao;

    /**
     * 插入课程
     *
     * @param course 课程实体
     * @return 结果码 0:成功插入；1:院系不存在；2:该课程已存在
     */
    @Override
    public int insert(Course course) {
        int course_num = courseDao.getByCode(course.getCourseID()).size();
        int faculty_num = facultyDao.getByCode(course.getFacultyCode()).size();
        if (faculty_num != 0 && course_num == 0) {
            courseDao.insert(course);
            return 0;
        } else if (faculty_num == 0) {
            return 1;
        } else {
            return 2;
        }
    }

    /**
     * 根据课程id删除课程
     *
     * @param courseID 课程id值
     * @return 结果码 0：删除成功；1：没有所要删除的课程
     */
    @Override
    public int delete(String courseID) {
        int course_num = courseDao.getByCode(courseID).size();
        if (course_num != 0) {
            courseDao.delete(courseID);
            return 0;
        } else {
            return 1;
        }
    }

    /**
     * 更新
     *
     * @param course 课程实体
     * @return 结果码 0:成功更新；1:院系不存在；2:该课程不存在
     */
    public int update(Course course) {
        int course_num = courseDao.getByCode(course.getCourseID()).size();
        int faculty_num = facultyDao.getByCode(course.getFacultyCode()).size();
        if (faculty_num != 0 && course_num != 0) {
            courseDao.update(course);
            return 0;
        } else if (faculty_num == 0) {
            return 1;
        } else {
            return 2;
        }
    }

    /**
     * 查询指定字段指定值的数据
     *
     * @param attribute 字段名
     * @param name      字段值
     * @return 查询结果
     */
    public List<Course> getByAttribute(String attribute, String name) {
        return courseDao.getByAttribute(attribute, name);
    }

    /**
     * 返回指定课程id的查询结果
     *
     * @param code 课程id值
     * @return 查询结果
     */
    public List<Course> getByCode(String code) {
        return courseDao.getByCode(code);
    }

    /**
     * 查询course表所有数据
     *
     * @return 查询结果
     */
    public List<Course> getList() {
        return courseDao.getList();
    }

    /**
     * 模糊查询course表
     *
     * @param map       查询条件
     * @param pageIndex 起始页
     * @param pageSize  大小
     * @return 查询结果
     */
    @Override
    public Map<Object, Object> query(Map<String, Object> map, int pageIndex, int pageSize) {
        return courseDao.query(map, pageIndex, pageSize);
    }
}
```

##### CourseClassController

```java
@RestController
@RequestMapping("/courseClass")
public class CourseClassController {
    @Resource
    private CourseClassService courseClassService;

    @PreAuthorize("hasRole('ADMIN')")
    @PostMapping("/insert")
    public Result<CourseClass> insertController(@RequestBody CourseClass courseClass) {
        int result = courseClassService.insert(courseClass);
        if (result == 0) {
            return Result.success(courseClass);
        } else if (result == 1) {
            return Result.error("1", "对应课程不存在，插入失败！");
        } else if (result == 2) {
            return Result.error("2", "对应教师不存在，插入失败！");
        } else {
            return Result.error("3", "当前记录已存在，插入失败！");
        }
    }

    @PreAuthorize("hasRole('ADMIN')")
    @PostMapping("/update")
    public Result<CourseClass> updateController(@RequestBody CourseClass courseClass) {
        int result = courseClassService.update(courseClass);
        if (result == 0) {
            return Result.success(courseClass);
        } else if (result == 1) {
            return Result.error("1", "对应课程不存在，更新失败！");
        } else if (result == 2) {
            return Result.error("2", "对应教师不存在，更新失败！");
        } else {
            return Result.error("3", "当前记录不存在，更新失败！");
        }
    }

    @PreAuthorize("hasRole('ADMIN')")
    @PostMapping("/delete")
    public Result<String> deleteController(@RequestParam String courseClassID) {
        int result = courseClassService.delete(courseClassID);
        if (result == 0) {
            return Result.success(courseClassID);
        } else if (result == 1) {
            return Result.error("1", "对应学生选课非空，删除失败！");
        } else {
            return Result.error("2", "该课程班级不存在，删除失败！");
        }
    }

    @PreAuthorize("hasRole('ADMIN')")
    @GetMapping("/list")
    public Result<List<CourseClass>> listController() {
        List<CourseClass> list = courseClassService.getList();
        if (!list.isEmpty()) {
            return Result.success(list, "列表查看成功！");
        } else {
            return Result.error("1", "当前列表为空！");
        }
    }



    @PreAuthorize("hasRole('ADMIN')")
    @PostMapping("/query")
    public Result<Map<Object, Object>> queryController(@RequestBody Map<String,Object> map, @RequestParam int pageIndex, @RequestParam int pageSize) {
        Map<Object, Object> response = courseClassService.query(map, pageIndex, pageSize);
        if ((int) response.get("total") != 0) {
            return Result.success(response, "查询成功");
        } else {
            return Result.error("1", "查询结果为空");
        }
    }
    @PreAuthorize("hasAnyRole('STUDENT','TEACHER')")
    @PostMapping("/queryByUser")
    public Result<Map<Object, Object>> queryByUserController(@RequestBody Map<String,Object> map, @RequestParam int pageIndex, @RequestParam int pageSize) {
        Map<Object, Object> response = courseClassService.queryByUser(map, pageIndex, pageSize);
        if ((int) response.get("total") != 0) {
            return Result.success(response, "查询成功");
        } else {
            return Result.error("1", "查询结果为空");
        }
    }
    @PreAuthorize("hasRole('TEACHER')")
    @PostMapping("/queryByTeacher")
    public Result<Map<Object, Object>> queryByTeacherController(@RequestBody Map<String,Object> map,@RequestParam int pageIndex, @RequestParam int pageSize) {
        map.put("teacherID", SecurityUtil.getUserName());
        Map<Object, Object> response = courseClassService.query(map, pageIndex, pageSize);
        if ((int) response.get("total") != 0) {
            return Result.success(response, "查询成功");
        } else {
            return Result.error("1", "查询结果为空");
        }
    }

    @PreAuthorize("hasRole('TEACHER')")
    @PostMapping("/insertByTeacher")
    public Result<CourseClass> insertByTeacherController(@RequestBody CourseClass courseClass) {
        int result = courseClassService.insertByTeacher(courseClass);
        if (result == 0) {
            return Result.success(courseClass);
        } else if (result == 1) {
            return Result.error("1", "对应课程不存在，插入失败！");
        } else  {
            return Result.error("2", "当前记录已存在，插入失败！");
        }
    }

    @PreAuthorize("hasRole('TEACHER')")
    @PostMapping("/updateByTeacher")
    public Result<CourseClass> updateByTeacherController(@RequestBody CourseClass courseClass) {
        int result = courseClassService.updateByTeacher(courseClass);
        if (result == 0) {
            return Result.success(courseClass);
        } else if (result == 1) {
            return Result.error("1", "对应课程不存在，更新失败！");
        } else  {
            return Result.error("2", "当前记录不存在，更新失败！");
        }
    }

    @PreAuthorize("hasRole('TEACHER')")
    @PostMapping("/deleteByTeacher")
    public Result<String> deleteByTeacherController(@RequestParam String courseClassID) {
        int result = courseClassService.deleteByTeacher(courseClassID);
        if (result == 0) {
            return Result.success(courseClassID);
        } else if (result == 1) {
            return Result.error("1", "对应学生选课非空，删除失败！");
        } else if (result == 2){
            return Result.error("2", "该课程班级不存在，删除失败！");
        }else
        {
            return Result.error("3","该课程不是你开的！");
        }
    }
}
```



### 3.4 课程管理

#### 3.4.1 课程信息管理

#### 3.4.2 学生选课管理

## 4.登录相关功能分析

### 4.1 注册管理员

POST http://localhost:8081/admin/adminRegister?username=admin&password=123456&code=hnu123456

请求格式：

```
?username=admin&password=123456&code=hnu123456
```

返回格式:

```json
//成功
{
    "code": "200",
    "message": "注册成功"

//失败    
{
    "code": "500",
    "message": "邀请码不正确"
}
{
    "code": "500",
    "message": "该用户名已存在"
}
```

### 4.2 登录

POST http://localhost:8081/user/login?username=admin&password=123456

请求格式：

```
?username=admin&password=123456
```

返回格式：

```json
//成功
{
    "code": "200",
    "data": {
        "role": [
            {
                "authority": "ADMIN"
            }
        ],
        "token": "eyJhbGciOiJIUzUxMiJ9.eyJqdGkiOiI3Iiwic3ViIjoiYWRtaW4iLCJpYXQiOjE2NTM1NjA2NDAsImlzcyI6InNhbnMiLCJhdXRob3JpdGllcyI6Ilt7XCJhdXRob3JpdHlcIjpcIkFETUlOXCJ9XSIsImV4cCI6MTY1MzY0NzA0MH0.rD8k-WLdr1NEXqlgALoKfhzFtufNhv7XxP-D7oUR1VhmRX9l5N9Yg1aLv5Mcrey5__JpYVr_nXpHQ4TFpl2AeQ"
    },
    "message": "登录成功"
}

//失败
{
    "code": "500",
    "message": "用户名密码不正确"
}
```

- 未登录（Token过期/无效）会将http状态码设置为401。'

  ,application/json,text/palin,

### 4.3 登出

POST http://localhost:8081/user/logout

 **前端需要清除掉Token**

返回格式：

```json
{
    "code": "200",
    "message": "登出成功"
}
```

### 4.4 注册普通用户

> 仅限管理员使用

POST http://localhost:8081/admin/userRegister?username=02&password=123456&role=STUDENT

请求格式:

```
?username=02&password=123456&role=STUDENT
```

返回格式:

```json
//成功:
{
    "code": "200",
    "message": "注册成功"
}

//失败
{
    "code": "1",
    "message": "该学生不存在"
}
{
    "code": "2",
    "message": "该教师不存在"
}
{
    "code": "3",
    "message": "该用户名已存在"
}
{
    "code": "4",
    "message": "不存在该角色"
}
```

### 4.5 当前用户修改密码

POST http://localhost:8081/user/changePassword

请求格式:

```json
{
    "oldPassword": "123456",
    "newPassword": "1234567"
}
```

返回格式:

```json
//成功
{
    "code": "200",
    "message": "修改成功"
}
```

## 5.管理员端功能分析

### 5.1 角色权限管理

#### 5.1.1 查看所有用户的角色

- 精确查找，username为空则查看全部

POST http://localhost:8081/admin/selectUserRole

请求格式：

```
?pageIndex=1&pageSize=3
```

```json
{
    "username":""
}
```

返回格式：

```json
{
    "code": "0",
    "message": "查询成功",
    "data": {
        "total": 3,
        "pageIndex": 1,
        "tableData": [
            {
                "username": "0001",
                "role_name": "TEACHER"
            },
            {
                "username": "02",
                "role_name": "STUDENT"
            },
            {
                "username": "admin",
                "role_name": "ADMIN"
            }
        ]
    }
}

//失败
{
    "code": "1",
    "message": "查询结果为空",
    "data": null
}
```

#### 5.1.2 授予角色

POST http://localhost:8081/admin/insertRole

请求格式：

```json
{
    "username":"0001",
    "roleName":"STUDENT",	//三个值：ADMIN,STUDENT,TEACHER
    "superCode":null	//超级权限码：正确则可以授予角色ADMIN，撤销其它角色不需要（默认正确值为：hnu123456）
}
```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "成功授予角色",
    "data": {
        "username": "0001",
        "roleName": "STUDENT",
        "superCode": null
    }
}
{
    "code": "1",
    "message": "撤销了该用户唯一的角色，该用户被删除",
    "data": null
}
//失败
{
    "code": "2",
    "message": "超级权限码错误，无法授予ADMIN角色",
    "data": null
}
{
    "code": "3",
    "message": "该角色不存在",
    "data": null
}
{
    "code": "4",
    "message": "无法授予学生和管理员额外的角色",
    "data": null
}
```

#### 5.1.3 撤销角色

POST http://localhost:8081/admin/deleteRole

请求格式：

```json
{
    "username":"0001",
    "roleName":"STUDENT",	//三个值：ADMIN,STUDENT,TEACHER
    "superCode":null	//超级权限码：正确则可以撤销角色ADMIN，撤销其它角色不需要（默认正确值为：hnu123456）
}
```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "成功撤销角色",
    "data": {
        "username": "0001",
        "roleName": "STUDENT",
        "superCode": null
    }
}

//失败
{
    "code": "1",
    "message": "该用户只有1个角色，无法撤销",
    "data": null
}
{
    "code": "2",
    "message": "超级权限码错误，无法撤销ADMIN角色",
    "data": null
}
{
    "code": "3",
    "message": "该用户没有该角色，无法撤销",
    "data": null
}
{
    "code": "4",
    "message": "不能撤销自己的管理员角色",
    "data": null
}
```



### 5.2 校建管理

#### 5.2.1 院系管理

##### 插入

post http://localhost:8081/faculty/insert

请求格式：

```json
{
    "facultyName": "环境工程学院",  		//not null
    "facultyCode": "0003",				//not null
    "facultyAddress": "湖南大学环境院",
    "facultyTeleno": "8801xxx"
}
```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "成功",
    "data": {
        "facultyName": "环境工程学院",
        "facultyCode": "0003",
        "facultyAddress": "湖南大学环境院",
        "facultyTeleno": "8801xxx"
    }
}
//失败
{
    "code": "1",
    "message": "当前记录已存在，插入失败！",
    "data": null
}
```

##### 更新

post http://localhost:8081/faculty/update

请求格式：

```json
{
    "facultyName": "土木工程学院",			//not null
    "facultyCode": "0002",					//not null
    "facultyAddress": "湖南大学土木院x",	
    "facultyTeleno": "88010003"
}
```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "成功",
    "data": {
        "facultyName": "土木工程学院",
        "facultyCode": "0002",
        "facultyAddress": "湖南大学土木院x",
        "facultyTeleno": "88010003"
    }
}
//失败
{
    "code": "1",
    "message": "当前记录不存在，无法更新！",
    "data": null
}
```

##### 删除

post http://localhost:8081/faculty/delete?facultyCode=0003

请求格式：

```json

```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "成功",
    "data": "0002"
}
//失败
{
    "code": "1",
    "message": "没有所要删除的课程，删除失败！",
    "data": null
}
```

##### 多条件查询

post http://localhost:8081/faculty/query?pageIndex=1&pageSize=2

```c
//全空即全部查询,
//null和"  "、""等效
```

请求格式：

```json
{
    "params":
    {
        "pageIndex": 1,
        "pageSize":2
    }
    "body":
    {
        "facultyName":"信息",
        "facultyCode": null,
        "facultyAddress": null,
        "facultyTeleno": null
	}
}
```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "查询成功",
    "data": {
        "total": 1,
        "pageIndex": 1,
        "tableData": [
            {
                "facultyName": "信息科学与工程学院",
                "facultyCode": "0001",
                "facultyAddress": "湖南大学信科院",
                "facultyTeleno": "8801002"
            }
        ]
    }
}
//失败
{
    "code": "1",
    "message": "查询结果为空",
    "data": null
}
```

#### 5.2.2 专业管理

##### 插入

post http://localhost:8081/major/insert

请求格式：

```json
{
    "majorName": "计算机科学与技术",    //not null
    "majorCode": "080901",			 //not null
    "facultyCode": "0001",			 //not null
    "degreeLevel": "本科",			//not null
    "graduationCredits":"60"		  //not null
}
{
    "majorName": "信息安全",
    "majorCode": "080904",
    "facultyCode": "0001",
    "degreeLevel": "本科",
    "graduationCredits":"61"
}
```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "成功",
    "data": {
        "majorName": "计算机科学与技术",
        "majorCode": "080901",
        "facultyCode": "0001",
        "degreeLevel": "本科",
        "graduationCredits": "60"
    }
}
//失败
{
    "code": "1",
    "message": "当前记录已存在，插入失败！",
    "data": null
}
{
    "code": "1",
    "message": "院系不存在，无法插入！",
    "data": null
}
```

##### 更新

post http://localhost:8081/major/update

请求格式：

```json
{
    "majorName": "计算机科学与技术",
    "majorCode": "080901",
    "facultyCode": "0001",
    "degreeLevel": "本科",
    "graduationCredits":"71"
}
```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "成功",
    "data": {
        "majorName": "计算机科学与技术",
        "majorCode": "080901",
        "facultyCode": "0001",
        "degreeLevel": "本科",
        "graduationCredits": "71"
    }
}
//失败
{
    "code": "1",
    "message": "当前记录不存在，无法更新！",
    "data": null
}
{
    "code": "1",
    "message": "院系不存在，无法更新！",
    "data": null
}
```

##### 删除

post http://localhost:8081/major/delete?majorCode=080901

请求格式：

```json
{
    "params":
    {
        "majorCode": "080901",
    }
}
```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "成功",
    "data": "080901"
}
//失败
{
    "code": "1",
    "message": "当前记录不存在，删除失败！",
    "data": null
}
```

##### 多条件查询

post http://localhost:8081/major/query?facultyName=信息科学与工程学院&pageIndex=1&pageSize=2

```c
//全空即全部查询,
//null和"  "、""等效
```

请求格式：

```json
{
    "params":
    {
        "facultyName": "信息科学与工程学院",
        "pageIndex": 1,
        "pageSize":2
    }
    "body":
    {
        "majorName": null,
        "majorCode": "",
        "facultyCode": "0001",
        "degreeLevel": "本科",
        "graduationCredits":""
	}
}
```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "查询成功",
    "data": {
        "total": 2,
        "pageIndex": 1,
        "tableData": [
            {
                "facultyCode": "0001",
                "facultyName": "信息科学与工程学院",
                "majorCode": "080901",
                "majorName": "计算机科学与技术",
                "degreeLevel": "本科",
                "graduationCredits": "61"
            },
            {
                "facultyCode": "0001",
                "facultyName": "信息科学与工程学院",
                "majorCode": "080904",
                "majorName": "信息安全",
                "degreeLevel": "本科",
                "graduationCredits": "61"
            }
        ]
    }
}
//失败
{
    "code": "1",
    "message": "查询结果为空",
    "data": null
}
```

#### 5.2.3 班级管理

##### 插入

post http://localhost:8081/class/insert

请求格式：

```json
{
    "className": "信安1901",
    "classCode": "2019080601",
    "majorCode": "080904"
}

{
    "className": "计科1901",
    "classCode": "2019080401",
    "majorCode": "080904"
}
```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "成功",
    "data": {
        "className": "计科1901",
        "classCode": "2019080401",
        "majorCode": "080904"
    }
}
//失败
{
    "code": "1",
    "message": "对应专业不存在，无法插入！",
    "data": null
}
{
    "code": "1",
    "message": "当前记录已存在，插入失败！",
    "data": null
}
```

##### 更新

post http://localhost:8081/class/update

请求格式：

```json
{
    "className": "计科1901",
    "classCode": "2019080401",
    "majorCode": "080904"
}
```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "成功",
    "data": {
        "className": "计科1901",
        "classCode": "2019080401",
        "majorCode": "080904"
    }
}
//失败
{
    "code": "1",
    "message": "对应专业不存在，无法更新！",
    "data": null
}
{
    "code": "1",
    "message": "当前记录不存在，无法更新！",
    "data": null
}
```

##### 删除

post http://localhost:8081/class/delete?classCode=2019080601

请求格式：

```json
{
    "params":
    {
        "classCode": "2019080601",
    }
}
```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "成功",
    "data": "计科1901"
}
//失败
{
    "code": "1",
    "message": "当前记录不存在，删除失败！",
    "data": null
}
```

##### 多条件查询

post http://localhost:8081/class/query?majorName=信息安全&facultyName=信息科学与工程学院&pageIndex=1&pageSize=30

```c
//全空即全部查询,
//null和"  "、""等效
```

请求格式：

```json
{
    "params":
    {
        "majorName": "信息安全",
        "facultyName": "信息科学与工程学院",
        "pageIndex": 1,
        "pageSize":2
    }
    "body":
    {
        "className": "",
        "classCode": "2019080601",
        "majorCode": "080904"
	}
}
```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "查询成功",
    "data": {
        "total": 2,
        "pageIndex": 1,
        "tableData": [
            {
                "facultyCode": "0001",
                "facultyName": "信息科学与工程学院",
                "majorCode": "080904",
                "majorName": "信息安全",
                "classCode": "2019080401",
                "className": "计科1901"
            },
            {
                "facultyCode": "0001",
                "facultyName": "信息科学与工程学院",
                "majorCode": "080904",
                "majorName": "信息安全",
                "classCode": "2019080601",
                "className": "信安1901"
            }
        ]
    }
}
//失败
{
    "code": "1",
    "message": "查询结果为空",
    "data": null
}
```

#### 5.2.4 学生管理

##### 插入

post http://localhost:8081/student/insert

请求格式：

```json
{
    "studentName": "小王",		//not null
    "studentID": "02",			 //not null
    "classCode": "2019080601",		//not null
    "identifier": "33068120010103050690",
    "dormitory": "天马学生公寓",
    "address": "湖南大写天马学生公寓三区506",
    "teleno": "13534348989",
    "birthday": "2001-01-03",
    "sex": "男",
    "grade": "19",
    "completedCredits": 23
}
```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "成功",
    "data": {
        "studentName": "小王",
        "studentID": "02",
        "classCode": "2019080601",
        "identifier": "33068120010103050690",
        "dormitory": "天马学生公寓",
        "address": "湖南大写天马学生公寓三区506",
        "teleno": "13534348989",
        "birthday": "2001-01-03",
        "sex": "男",
        "grade": "19",
        "completedCredits": "23"
    }
}
//失败
{
    "code": "1",
    "message": "班级不存在，无法插入！",
    "data": null
}
{
    "code": "1",
    "message": "当前记录已存在，插入失败！",
    "data": null
}
```

##### 更新

post http://localhost:8081/student/update

请求格式：

```json
{
    "studentName": "小王",
    "studentID": "02",
    "classCode": "2019080601",
    "identifier": "33068120010103050690",
    "dormitory": "天马学生公寓",
    "address": "湖南大写天马学生公寓三区506",
    "teleno": "13534348989",
    "birthday": "2001-01-04",
    "sex": "男",
    "grade": "19",
    "completedCredits": 23
}
```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "成功",
    "data": {
        "studentName": "小王",
        "studentID": "02",
        "classCode": "2019080601",
        "identifier": "33068120010103050690",
        "dormitory": "天马学生公寓",
        "address": "湖南大写天马学生公寓三区506",
        "teleno": "13534348989",
        "birthday": "2001-01-04",
        "sex": "男",
        "grade": "19",
        "completedCredits": "23"
    }
}
//失败
{
    "code": "1",
    "message": "班级不存在，无法更新！",
    "data": null
}
{
    "code": "1",
    "message": "当前记录不存在，无法更新！",
    "data": null
}
```

##### 删除

post http://localhost:8081/student/delete?studentID=021

请求格式：

```json
{
    "params":{
        "studentID": "02",
    }
}
```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "成功",
    "data": "02"
}
//失败
{
    "code": "1",
    "message": "当前记录不存在，删除失败！",
    "data": null
}
```

##### 多条件查询

post http://localhost:8081/student/query?className=&majorName=信息&facultyName&pageIndex=1&pageSize=30

```c
//全空即全部查询,
//null和"  "、""等效
```

请求格式：

```json
{
    "params":
    {
        "className": "计科1902",
        "majorName": "信息安全",
        "facultyName": "信息科学与工程学院",
        "pageIndex": 1,
        "pageSize":2
    }
    {
        "studentName":  null,
        "studentID": null,
        "classCode": "2019080601",
        "identifier": null,
        "dormitory": "天马学生公寓",
        "address": "湖南大写天马学生公寓三区506",
        "teleno": "13534348989",
        "birthday": "2001-01-03",
        "sex": "男",
        "grade": "19",
        "completedCredits":  null
    }
}
```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "查询成功",
    "data": {
        "total": 38,
        "pageIndex": 1,
        "tableData": [
            {
                "facultyCode": "0001",
                "facultyName": "信息科学与工程学院",
                "majorCode": "080901",
                "majorName": "计算机科学与技术",
                "classCode": "2019080402",
                "className": "计科1902",
                "studentName": "计科2班小王",
                "studentID": "01",
                "identifier": "33068120010103050690",
                "dormitory": "天马学生公寓",
                "address": "湖南大写天马学生公寓三区506",
                "teleno": "13534348989",
                "birthday": "2001-01-03",
                "sex": "男",
                "grade": "19",
                "completedCredits": 23
            },
            {
                "facultyCode": "0001",
                "facultyName": "信息科学与工程学院",
                "majorCode": "080904",
                "majorName": "信息安全",
                "classCode": "2019080601",
                "className": "信安1901",
                "studentName": "小王1",
                "studentID": "02",
                "identifier": "33068120010103050690",
                "dormitory": "天马学生公寓",
                "address": "湖南大写天马学生公寓三区506",
                "teleno": "13534348989",
                "birthday": "2001-01-03",
                "sex": "男",
                "grade": "19",
                "completedCredits": 23
            }
        ]
    }
}
//失败
{
    "code": "1",
    "message": "查询结果为空",
    "data": null
}
```

### 5.3 教师管理

#### 5.3.1 教师授课管理

##### 插入

post http://localhost:8081/courseClass/insert

请求格式：

```json
{
    "courseClassID": "01001",
    "courseID": "1",
    "teacherID": "0001",
    "courseClassTime": "",
    "courseClassAddress": null,
    "courseClassWeek": ""
}
```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "成功",
    "data": {
        "courseClassID": "01001",
        "courseID": "1",
        "teacherID": "0001",
        "courseClassTime": null,
        "courseClassAddress": null,
        "courseClassWeek": null
    }
}

//对应课程不存在，插入失败
{
    "code": "1",
    "message": "对应课程不存在，插入失败！",
    "data": null
}
//对应教师不存在，插入失败
{
    "code": "2",
    "message": "对应教师不存在，插入失败！",
    "data": null
}
//当前记录已存在，插入失败
{
    "code": "3",
    "message": "当前记录已存在，插入失败！",
    "data": null
}
```

##### 更新

post http://localhost:8081/courseClass/update

请求格式：

```json
{
    "courseClassID": "01001",
    "courseID": "1",
    "teacherID": "0001",
    "courseClassTime": null,
    "courseClassAddress": "综401",
    "courseClassWeek": null
}
```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "成功",
    "data": {
        "courseClassID": "01001",
        "courseID": "1",
        "teacherID": "0001",
        "courseClassTime": null,
        "courseClassAddress": "综401",
        "courseClassWeek": null
    }
}
//对应课程不存在，更新失败
{
    "code": "1",
    "message": "对应课程不存在，更新失败！",
    "data": null
}
//对应教师不存在，更新失败
{
    "code": "2",
    "message": "对应教师不存在，更新失败！",
    "data": null
}
//当前记录不存在，更新失败
{
    "code": "3",
    "message": "当前记录不存在，更新失败！",
    "data": null
}

```

##### 删除

post http://localhost:8081/courseClass/delete

请求格式：

```
?courseClassID=01001
```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "成功",
    "data": "01001"
}

//对应学生选课非空，删除失败
{
    "code": "1",
    "message": "对应学生选课非空，删除失败！",
    "data": null
}
//该课程班级不存在，删除失败
{
    "code": "2",
    "message": "该课程班级不存在，删除失败！",
    "data": null
}
```

##### 查询

post http://localhost:8081/courseClass/query

- 不设条件的为null

请求格式1：全部查询

```json
?pageIndex=1&pageSize=2
```

```json
{
    "courseClassID": null,
    "courseID": null,
    "courseName": null,
    "teacherID": null,
    "teacherName": null,
    "facultyName": null,
    "courseClassTime": null,
    "courseClassAddress": null,
    "courseClassWeek": null,
    "courseNature": null,
    "courseCategory": null,
    "courseHours": null,
    "credit": null
}
```

返回格式1：

```json
{
    "code": "0",
    "message": "查询成功",
    "data": {
        "total": 2,
        "pageIndex": 1,
        "tableData": [
            {
                "courseClassID": "01001",
                "courseID": "1",
                "courseName": "数据库",
                "teacherID": "0001",
                "teacherName": "李四",
                "facultyName": "信息科学与工程学院",
                "courseClassTime": null,
                "courseClassAddress": null,
                "courseClassWeek": null,
                "courseNature": "必修",
                "courseCategory": "专业核心",
                "courseHours": 32,
                "credit": 2
            },
            {
                "courseClassID": "01002",
                "courseID": "1",
                "courseName": "数据库",
                "teacherID": "0002",
                "teacherName": "李四",
                "facultyName": "信息科学与工程学院",
                "courseClassTime": null,
                "courseClassAddress": null,
                "courseClassWeek": null,
                "courseNature": "必修",
                "courseCategory": "专业核心",
                "courseHours": 32,
                "credit": 2
            }
        ]
    }
}
```

请求格式2：设有条件

```
?pageIndex=1&pageSize=2
```

```json
{
    "courseClassID": "01001",
    "courseID": null,
    "courseName": "数据库",
    "teacherID": null,
    "teacherName": null,
    "facultyName": "信息科学与工程学院",
    "courseClassTime": null,
    "courseClassAddress": null,
    "courseClassWeek": null,
    "courseNature": "必修",
    "courseCategory": "专业核心",
    "courseHours": 32,
    "credit": 2
}
```

返回格式2：

```json
{
    "code": "0",
    "message": "查询成功",
    "data": {
        "total": 1,
        "pageIndex": 1,
        "tableData": [
            {
                "courseClassID": "01001",
                "courseID": "1",
                "courseName": "数据库",
                "teacherID": "0001",
                "teacherName": "李四",
                "facultyName": "信息科学与工程学院",
                "courseClassTime": null,
                "courseClassAddress": null,
                "courseClassWeek": null,
                "courseNature": "必修",
                "courseCategory": "专业核心",
                "courseHours": 32,
                "credit": 2
            }
        ]
    }
}
```

#### 5.3.2 录入教师管理

##### 插入

post http://localhost:8081/teacher/insert

请求格式：

```json
{
    "teacherName":"张三",
    "teacherID":"0001",
    "facultyCode":"1"
}
```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "成功",
    "data": {
        "teacherName": "张三",
        "teacherID": "0001",
        "facultyCode": "1"
    }
}

//失败：对应院系不存在
{
    "code": "1",
    "message": "对应院系不存在，插入失败！",
    "data": null
}

//失败：当前记录已存在
{
    "code": "2",
    "message": "当前记录已存在，插入失败！",
    "data": null
}
```

##### 更新

post http://localhost:8081/teacher/update

请求格式：

```json
{
    "teacherName":"李四",
    "teacherID":"0001",
    "facultyCode":"1"
}
```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "成功",
    "data": {
        "teacherName": "李四",
        "teacherID": "0001",
        "facultyCode": "1"
    }
}

//失败：对应院系不存在
{
    "code": "1",
    "message": "对应院系不存在，插入失败！",
    "data": null
}

//失败：当前记录已存在
{
    "code": "2",
    "message": "当前记录已存在，插入失败！",
    "data": null
}
```

##### 删除（按ID）

post http://localhost:8081/teacher/delete?teacherID=0001

请求格式：

```
?teacherID=0001
```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "成功",
    "data": "0001"
}

//失败：对应课程班级非空
{
    "code": "1",
    "message": "对应课程班级非空，删除失败！",
    "data": null
}

//失败：当前教师不存在
{
    "code": "2",
    "message": "当前教师不存在，删除失败！",
    "data": null
}
```

##### 查询

post http://localhost:8081/teacher/query

- 不设条件的为null

请求格式1：全部查询

```
?pageIndex=1&pageSize=2
```

```json
{
    "teacherName": null,
    "teacherID": null,
    "facultyCode": null,
    "facultyName": null
}
```

返回格式1：

```json
{
    "code": "0",
    "message": "查询成功",
    "data": {
        "total": 2,
        "pageIndex": 1,
        "tableData": [
            {
                "teacherID": "0001",
                "teacherName": "李四",
                "facultyCode": "0001",
                "facultyName": "信息科学与工程学院"
            },
            {
                "teacherID": "0002",
                "teacherName": "李四",
                "facultyCode": "0002",
                "facultyName": "土木工程学院"
            }
        ]
    }
}
```

请求格式2：设有条件

```
?pageIndex=1&pageSize=2
```

```json
{
    "teacherName":null,
    "teacherID":"0001",
    "facultyCode":"0001"
    "facultyName": null
}
```

返回格式2：

```json
//查询成功
{
    "code": "0",
    "message": "查询成功",
    "data": {
        "total": 1,
        "pageIndex": 1,
        "tableData": [
            {
                "teacherID": "0001",
                "teacherName": "李四",
                "facultyCode": "0001",
                "facultyName": "信息科学与工程学院"
            }
        ]
    }
}
//查询失败
{
    "code": "1",
    "message": "查询结果为空",
    "data": null
}
```

### 5.4 课程管理

#### 5.3.1 课程信息管理

##### 插入

`post http://localhost:8081/course/insert`

请求格式：

```json
{
    "courseName": "数据库",
    "courseNature": "必修",
    "courseCategory": "专业课",
    "courseID": "0001",
    "facultyCode": "0001",
    "courseHours": 25,
    "credit": 2
}
{
    "courseName": "计网",
    "courseNature": "必修",
    "courseCategory": "专业课",
    "courseID": "0002",
    "facultyCode": "0001",
    "courseHours": 25,
    "credit": 2
}
```

返回格式：

```json
{
    "code": "0",
    "message": "成功",
    "data": {
        "courseName": "数据库",
        "courseNature": "必修",
        "courseCategory": "专业课",
        "courseID": "0002",
        "facultyCode": "0001",
        "courseHours": 25,
        "credit": 2
    }
}
{
    "code": "2",
    "message": "该课程已存在，插入失败！",
    "data": null
}
```

##### 更新

`post http://127.0.0.1:8081/course/update`

请求格式：

```json
{
    "courseName": "数据库",
    "courseNature": "必修2",
    "courseCategory": "专业课",
    "courseID": "0002",
    "facultyCode": "0001",
    "courseHours": 25,
    "credit": 2
}
```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "成功",
    "data": {
        "courseName": "数据库",
        "courseNature": "必修2",
        "courseCategory": "专业课",
        "courseID": "0002",
        "facultyCode": "0001",
        "courseHours": 25,
        "credit": 2
    }
}
//失败
{
    "code": "2",
    "message": "该课程不存在，更新失败！",
    "data": null
}
```

##### 删除

`post http://127.0.0.1:8081/course/delete?courseID=0002`

请求格式：

```json
{
    "facultyName": "信息科学与工程学院",
    "facultyCode": "0001",
    "facultyAddress": "湖南大学信科院",
    "facultyTeleno": "8801002"
}
```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "成功",
    "data": "0002"
}
//失败
{
    "code": "1",
    "message": "没有所要删除的课程，删除失败！",
    "data": null
}
```

##### 多条件查询

`post http://localhost:8081/course/query?pageIndex=1&pageSize=2`

```c
//全空即全部查询,
//null和"  "、""等效
```

请求格式：

```json
{
    "credit": 2
}
```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "查询成功",
    "data": {
        "total": 1,
        "pageIndex": 1,
        "tableData": [
            {
                "courseName": "数据库",
                "courseNature": "必修",
                "courseCategory": "专业课",
                "courseID": "0002",
                "facultyCode": "0001",
                "courseHours": 25,
                "credit": 2
            }
        ]
    }
}
//失败
{
    "code": "1",
    "message": "查询结果为空",
    "data": null
}
```

#### 5.3.2 选修信息管理

##### 插入

`post http://127.0.0.1:8081/studentcourse/insert`

请求格式：

```json
{
    "courseClassID": "01001",
    "studentID": "01",
    "score": 98
}
{
    "courseClassID": "01001",
    "studentID": "02",
    "score": 94
}
```

返回格式：

```json
{
    "code": "0",
    "message": "成功",
    "data": {
        "courseClassID": "01001",
        "studentID": "01",
        "score": 98
    }
}
{
    "code": "2",
    "message": "没有课程班级，插入失败！",
    "data": null
}
```

##### 更新

`post http://localhost:8081/studentcourse/update`

请求格式：

```json
{
    "courseClassID": "01001",
    "studentID": "01",
    "score": 95
}
```

返回格式：

```json
{
    "code": "0",
    "message": "成功",
    "data": {
        "courseClassID": "01001",
        "studentID": "01",
        "score": 95
    }
}
{
    "code": "2",
    "message": "没有课程班级，更新失败！",
    "data": null
}
```

##### 删除

`post 127.0.0.1:8081/studentcourse/delete?courseClassID=01001&&studentID=01`

请求格式：

```json
?courseClassID=01001
```

返回格式：

```json
{
    "code": "0",
    "message": "成功",
    "data": "01001 01"
}
{
    "code": "1",
    "message": "没有找到要删除的记录，删除失败！",
    "data": null
}
```

##### 多条件查询

`post http://127.0.0.1:8081/studentcourse/query?pageIndex=1&pageSize=2`

```c
//全空即全部查询,
//null和"  "、""等效
```

请求格式：

```json
{
    "score": 94
}
```

返回格式：

```json
{
    "code": "0",
    "message": "查询成功",
    "data": {
        "total": 1,
        "pageIndex": 1,
        "tableData": [
            {
                "studentID": "02",
                "studentName": "小王",
                "score": 94,
                "courseName": "数据库"
            }
        ]
    }
}
{
    "code": "1",
    "message": "查询结果为空",
    "data": null
}
```

## 6.学生端功能分析

### 6.1 校园信息查询

#### 6.1.1 院系查询

同管理端查询接口

#### 6.1.2 专业查询

同管理端查询接口

#### 6.1.3 班级查询

同管理端查询接口

### 6.2 个人信息管理

#### 6.2.1 信息查询

查询自己的信息

post http://localhost:8081/student/info

```json
//成功
{
    "code": "0",
    "message": "查看成功！",
    "data": [
        {
            "facultyName": "信息科学与工程学院",
            "facultyCode": "0001",
            "majorName": "计算机科学与技术",
            "majorCode": "080901",
            "className": "计科1902",
            "classCode": "2019080402",
            "studentName": "计科2班小王",
            "studentID": "01",
            "identifier": "33068120010103050690",
            "dormitory": "天马学生公寓",
            "address": "湖南大写天马学生公寓三区506",
            "teleno": "13534348989",
            "birthday": "2001-01-03",
            "sex": "男",
            "grade": "19",
            "completedCredits": 23
        }
    ]
}
//失败
{
    "code": "1",
    "message": "查询结果为空",
    "data": null
}
```

#### 6.2.2 更新信息

post http://localhost:8081/student/updateByStudent

请求格式

```
{
    "studentName": "小王",
    "studentID": "02",
    "classCode": "2019080601",
    "identifier": "33068120010103050690",
    "dormitory": "天马学生公寓",
    "address": "湖南大写天马学生公寓三区506",
    "teleno": "13534348989",
    "birthday": "2001-01-03",
    "sex": "男",
    "grade": "19",
    "completedCredits": 23
}
```

但是学生只能更新可以修改的信息，且不能更新别人的信息

后端已经默认认为studentName，studentID，completedCredits，classCode都不能修改，即使提供了但是也不会更新。

返回格式：

```
//成功
{
    "code": "0",
    "message": "成功",
    "data": {
        "studentName": "小王",
        "studentID": "02",
        "classCode": "2019080601",
        "identifier": "33068120010103050690",
        "dormitory": "天马学生公寓",
        "address": "湖南大写天马学生公寓三区506",
        "teleno": "13534348989",
        "birthday": "2001-01-04",
        "sex": "男",
        "grade": "19",
        "completedCredits": "23"
    }
}
//失败
{
    "code": "1",
    "message": "班级不存在，无法更新！",
    "data": null
}
{
    "code": "1",
    "message": "当前记录不存在，无法更新！",
    "data": null
}
```

### 6.3 课程信息查询

#### 6.3.1 查询可选课程

相比于管理员的该接口，查询条件和结果**都少了“TeacherID”属性**

post http://localhost:8081/courseClass/queryByUser

#### 6.3.2 教师信息查询

无法得到其它教师的ID

post http://localhost:8081/teacher/queryWithoutID

请求格式：

```
?pageIndex=1&pageSize=2
```

```json
{
    "teacherName":null,
    "facultyCode":"0001",
    "facultyName": null
}
```

返回格式:

```json
{
    "code": "0",
    "message": "查询成功",
    "data": {
        "total": 1,
        "pageIndex": 1,
        "tableData": [
            {
                "teacherName": "李四",
                "facultyCode": "0001",
                "facultyName": "信息科学与工程学院"
            }
        ]
    }
}
```

#### 6.3.3 课程信息多条件查询

`post http://localhost:8081/faculty/query?pageIndex=1&pageSize=2`

```c
//全空即全部查询,
//null和"  "、""等效
```

请求格式：

```json
{
    "credit": 2
}
```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "查询成功",
    "data": {
        "total": 1,
        "pageIndex": 1,
        "tableData": [
            {
                "courseName": "数据库",
                "courseNature": "必修",
                "courseCategory": "专业课",
                "courseID": "0002",
                "facultyCode": "0001",
                "courseHours": 25,
                "credit": 2
            }
        ]
    }
}
//失败
{
    "code": "1",
    "message": "查询结果为空",
    "data": null
}
```

### 6.4 学生选课

#### 6.4.1 插入

`post http://127.0.0.1:8081/studentcourse/insertByStudent?courseClassID=01001`

请求格式：

```json
{
    "courseClassID": "01001",
    "studentID": "01",
    "score": 98
}
```

返回格式：

```json
{
    "code": "0",
    "message": "成功",
    "data": "01001 01"
}
{
    "code": "2",
    "message": "没有课程班级，插入失败！",
    "data": null
}
```

#### 6.4.2 删除

`post 127.0.0.1:8081/studentcourse/deleteByStudent?courseClassID=01001`

请求格式：

```json
?courseClassID=01001
```

返回格式：

```json
{
    "code": "0",
    "message": "成功",
    "data": "01001 01"
}
{
    "code": "2",
    "message": "没有课程班级，插入失败！",
    "data": null
}
```

#### 6.4.3 多条件选课信息查询

（只能查自己）

`post http://127.0.0.1:8081/studentcourse/queryByStudent?pageIndex=1&pageSize=2`

```c
//全空即全部查询,
//null和"  "、""等效
```

请求格式：

```json
{
    "studentID": "01"
}
```

返回格式：

```json
{
    "code": "0",
    "message": "查询成功",
    "data": {
        "total": 1,
        "pageIndex": 1,
        "tableData": [
            {
                "studentID": "01",
                "studentName": "小张",
                "score": 0,
                "courseName": "数据库"
            }
        ]
    }
}
```

## 7.教师端功能分析

### 7.1 校园信息查询

#### 7.1.1 院系查询

同管理端查询接口

#### 7.1.2 专业查询

同管理端查询接口

#### 7.1.2 班级查询

同管理端查询接口

### 7.2 个人信息管理

#### 7.2.1 教师公共信息查询

无法得到其它教师的ID

post http://localhost:8081/teacher/queryWithoutID

请求格式：

```
?pageIndex=1&pageSize=2
```

```json
{
    "teacherName":null,
    "facultyCode":"0001",
    "facultyName": null
}
```

返回格式:

```json
{
    "code": "0",
    "message": "查询成功",
    "data": {
        "total": 1,
        "pageIndex": 1,
        "tableData": [
            {
                "teacherName": "李四",
                "facultyCode": "0001",
                "facultyName": "信息科学与工程学院"
            }
        ]
    }
}
```

#### 7.2.2 得到自己的信息

post http://localhost:8081/teacher/info

返回格式：

```JSON
{
    "code": "0",
    "message": "查看成功！",
    "data": [
        {
            "teacherID": "0001",
            "teacherName": "李四",
            "facultyCode": "0001",
            "facultyName": "信息科学与工程学院"
        }
    ]
}
```

### 7.3 教师授课管理

#### 7.3.1 插入

post http://localhost:8081/courseClass/insertByTeacher

请求格式：

- teacherID固定为null（教师插入课程，表示教师自身开课）

```json
{
    "courseClassID": "01001",
    "courseID": "1",
    "teacherID": null,
    "courseClassTime": "",
    "courseClassAddress": null,
    "courseClassWeek": ""
}
```

返回格式

```json
//成功
{
    "code": "0",
    "message": "成功",
    "data": {
        "courseClassID": "01003",
        "courseID": "1",
        "teacherID": "0001",
        "courseClassTime": "",
        "courseClassAddress": null,
        "courseClassWeek": ""
    }
}

//对应课程不存在，插入失败
{
    "code": "1",
    "message": "对应课程不存在，插入失败！",
    "data": null
}
//当前记录已存在，插入失败
{
    "code": "2",
    "message": "当前记录已存在，插入失败！",
    "data": null
}
```

#### 7.3.2 更新

post http://localhost:8081/courseClass/updateByTeacher

请求格式：

- teacherID固定为null（教师只能更新自己的课程）

```json
{
    "courseClassID": "01003",
    "courseID": "1",
    "teacherID": null,
    "courseClassTime": "一(1,2)",
    "courseClassAddress": null,
    "courseClassWeek": ""
}
```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "成功",
    "data": {
        "courseClassID": "01003",
        "courseID": "1",
        "teacherID": "0001",
        "courseClassTime": "一(1,2)",
        "courseClassAddress": null,
        "courseClassWeek": ""
    }
}

//对应课程不存在，更新失败
{
    "code": "1",
    "message": "对应课程不存在，更新失败！",
    "data": null
}
//当前记录不存在，更新失败
{
    "code": "2",
    "message": "当前记录不存在，更新失败！",
    "data": null
}
```

#### 7.3.3 删除

post http://localhost:8081/courseClass/deleteByTeacher?courseClassID=01001

请求格式：

```json
?courseClassID=01001
```

返回格式:

```json
//成功
{
    "code": "0",
    "message": "成功",
    "data": "01001"
}

//对应学生选课非空，删除失败
{
    "code": "1",
    "message": "对应学生选课非空，删除失败！",
    "data": null
}
//该课程班级不存在，删除失败
{
    "code": "2",
    "message": "该课程班级不存在，删除失败！",
    "data": null
}
//该课程不是你开的
{
    "code": "3",
    "message": "该课程不是你开的！",
    "data": null
}
```

#### 7.3.4 查询（用于查看开课信息）

相比于管理员的该接口，查询条件和结果**都少了“TeacherID”属性**

post http://localhost:8081/courseClass/queryByUser

#### 7.3.5 查询自己的授课信息

POST http://localhost:8081/courseClass/queryByTeacher

请求格式：

```
?pageIndex=1&pageSize=2
```

```json
{
    "courseClassID": "01001",
    "courseID": null,
    "courseName": "数据库",
    "courseClassTime": null,
    "courseClassAddress": null,
    "courseClassWeek": null,
    "courseNature": "必修",
    "courseCategory": "专业核心",
    "courseHours": 32,
    "credit": 2
}
```

返回格式：

```json
{
    "code": "0",
    "message": "查询成功",
    "data": {
        "total": 1,
        "pageIndex": 1,
        "tableData": [
            {
                "courseClassID": "01001",
                "courseID": "1",
                "courseName": "数据库",
                "teacherID": "0001",
                "teacherName": "李四",
                "facultyName": "信息科学与工程学院",
                "courseClassTime": null,
                "courseClassAddress": null,
                "courseClassWeek": null,
                "courseNature": "必修",
                "courseCategory": "专业核心",
                "courseHours": 32,
                "credit": 2
            }
        ]
    }
}
```

### 7.4 课程信息管理

#### 7.4.1 课程信息查询

`post http://localhost:8081/course/query?pageIndex=1&pageSize=2`

```c
//全空即全部查询,
//null和"  "、""等效
```

请求格式：

```json
{
    "credit": 2
}
```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "查询成功",
    "data": {
        "total": 1,
        "pageIndex": 1,
        "tableData": [
            {
                "courseName": "数据库",
                "courseNature": "必修",
                "courseCategory": "专业课",
                "courseID": "0002",
                "facultyCode": "0001",
                "courseHours": 25,
                "credit": 2
            }
        ]
    }
}
//失败
{
    "code": "1",
    "message": "查询结果为空",
    "data": null
}
```

#### 7.4.2 学生成绩更新

`post http://localhost:8081/studentcourse/updateByTeacher`

请求格式：

```json
{
    "courseClassID": "01001",
    "studentID": "01",
    "score": 95
}
{
    "courseClassID": "01001",
    "studentID": "02",
    "score": 95
}
```

返回格式：

```json
{
    "code": "0",
    "message": "成功",
    "data": {
        "courseClassID": "01001",
        "studentID": "02",
        "score": 95
    }
}
{
    "code": "1",
    "message": "没有找到对应的选课，更新失败！",
    "data": null
}
```

#### 7.4.3 学生成绩查询

`post http://127.0.0.1:8081/studentcourse/queryByTeacher?pageIndex=1&pageSize=2`

```c
//全空即全部查询,
//null和"  "、""等效
```

请求格式：

```json
{
    "score": 94
}
```

返回格式：

```json
{
    "code": "0",
    "message": "查询成功",
    "data": {
        "total": 1,
        "pageIndex": 1,
        "tableData": [
            {
                "studentID": "02",
                "studentName": "小王",
                "score": 94,
                "courseName": "数据库"
            }
        ]
    }
}
{
    "code": "1",
    "message": "查询结果为空",
    "data": null
}
```

# 五、界面设计

## 1.环境要求

- vue 采用新版，使用了vue-cli4搭建的系统，减少大量配置文件
- element-ui 最流行的vue UI框架
- vue-element-admin 深度定制版

## 2.项目整体架构

项目整体架构大致分为

1. api：用于存放前端调用的各类 API 连接
2. component 部分：用于存放前端显示页面各个部件的源码实现
3. layout 部分：用于存放前端布局的源码实现
4. icons 部分：用于存放前端所使用到的各个图标部分
5. store 部分：用于存放实现持续性数据存储的源码实现
6. styles 部分：用于存放前端页面中颜色大小等显示风格的源码实现
7. utils 部分：用于存放杂项实现，例如网络请求等
8. vues 部分：最核心的部分，用于存放前端各个页面中部件的组织方式

## 3.管理员端

## 4.学生端

1. 学生登陆会如下显示：

	![image-20220604222716220](数据库课程报告/image-20220604222716220.png)

2. 可以通过这个界面修改个人信息

	![image-20220604222755885](数据库课程报告/image-20220604222755885.png)

3. 可以对自己的账户密码进行修改

	![image-20220604222837798](数据库课程报告/image-20220604222837798.png)

4. 在校建信息中可以查看班级信息、学院信息、专业信息以及教师信息，并且都可以进行模糊查找

	![image-20220604223041813](数据库课程报告/image-20220604223041813.png)

	![image-20220604223057424](数据库课程报告/image-20220604223057424.png)

	![image-20220604223109948](数据库课程报告/image-20220604223109948.png)

	![image-20220604223122381](数据库课程报告/image-20220604223122381.png)

	模糊查找：

	![image-20220604223206209](数据库课程报告/image-20220604223206209.png)

5. 可查看所有课程信息

	![image-20220604223244070](数据库课程报告/image-20220604223244070.png)

6. 查看已开课程信息，点击选课可以进行选课操作

	![image-20220604223336837](数据库课程报告/image-20220604223336837.png)

7. 学生可以查看自己已选的课程，对于老师没有打分的科目可以及进行退选

	![image-20220604223522401](数据库课程报告/image-20220604223522401.png)

## 5.教师端

1. 教师登录后会如下显示教师信息：

	![image-20220604223712118](数据库课程报告/image-20220604223712118.png)

2. 可以对自己的账户密码进行修改

	![image-20220604223800448](数据库课程报告/image-20220604223800448.png)

3. 同样的也可以对校建信息中的专业信息，班级信息，学员信息以及教师信息进行查询，并且都支持模糊查询

	![image-20220604223908531](数据库课程报告/image-20220604223908531.png)

	![image-20220604223921579](数据库课程报告/image-20220604223921579.png)

	![image-20220604223949795](数据库课程报告/image-20220604223949795.png)

	![image-20220604224003565](数据库课程报告/image-20220604224003565.png)

	模糊匹配：

	![image-20220604224042403](数据库课程报告/image-20220604224042403.png)

4. 查看所有课程信息

	![image-20220604224116557](数据库课程报告/image-20220604224116557.png)

5. 显示教师自己的执教课程并且可以添加课程，修改课程以及删除课程（都是对自己的课程进行操作，不能操作别人的课程）

	![image-20220604224232442](数据库课程报告/image-20220604224232442.png)

6. 查看所有已开课程

	![image-20220604224304208](数据库课程报告/image-20220604224304208.png)

7. 老师可以对自己课程的学生进行成绩的修改和查看

	![image-20220604224349257](数据库课程报告/image-20220604224349257.png)

# 六、项目使用说明

- 该项目实现前后端分离开发策略。前后端的分离有助于提高开发效率，同时后端与前端的开发信息传输通过文档进行，留下了丰富的接口文档。

- 在使用该项目时，需要先创建所需的数据表。该项目所创建的表格个数为 13 个，使用者可以直接导入以下两个 sql 文件至 mysql 中，完成自动创建表以及自动设置触发器的操作，无需人工干预：

  - `powerdesigner\1.sql`：用于创建权限控制相关的表格
  - `powerdesigner\crebas.sql`：用于创建教师学生选课信息等业务逻辑相关数据的表格

- 在完成数据表的创建后，务必使用 IDEA pro 版本来启动后端 `backend\`，因为后端使用了 spring-boot 框架。

- 当后端能成功打开后，在 `frontend\` 下，键入 `npm i` 以自动下载前端所需要的各类包。待安装完成后，执行 `npm run serve` 以启动前端。

- 接下来便可访问 `localhost:8002` 以访问前端。

  > 注：前端默认位于 `localhost:8002`，后端默认位于 `localhost:8081`。
  >
  > 后端的部署端口，以及所使用的数据库地址与端口，均可在 `backend\src\main\resources\application.yml` 中进行修改。
  >
  > 前端的部署端口可在 `frontend\vue.config.js` 中进行修改。

  > 需要注意的是，由于前后端是分离控制的，因此会涉及一个跨域问题。这里，跨域问题的解决是通过在 vue 中实现一个中继代理，通过转发来实现对后端接口访问。
  >
  > 例如，访问前端 `localhost:8002/api/path1/path2` 的请求，将会被转发至后端 `localhost:8081/path1/path2`。
  >
  > 注意前端中的 `/api` 将在转发至后端时被自动置换，详情可查看 `frontend\vue.config.js`
  >
  > 由于前端中的全部请求都是访问同域资源，例如 `localhost:8002/views1` 访问 `localhost:8002:/api/api1`，而实际的访问将通过代理转发至后端，因此跨域问题将得以解决。
